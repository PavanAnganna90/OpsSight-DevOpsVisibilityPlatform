{"version":3,"sources":["/Users/pavan/Desktop/Devops-app-dev-cursor/frontend/src/services/websocket.ts"],"sourcesContent":["/**\n * WebSocket Service for Real-time Kubernetes Events\n * \n * Provides real-time streaming of Kubernetes cluster events including\n * pod status changes, node events, resource alerts, and system notifications.\n */\n\n// Event types for Kubernetes real-time updates\nexport interface KubernetesEvent {\n  id: string;\n  type: 'pod' | 'node' | 'cluster' | 'resource' | 'alert';\n  action: 'created' | 'updated' | 'deleted' | 'error';\n  timestamp: string;\n  clusterId: string;\n  data: any;\n  severity?: 'info' | 'warning' | 'error' | 'critical';\n}\n\nexport interface WebSocketConfig {\n  url: string;\n  reconnectInterval: number;\n  maxReconnectAttempts: number;\n  heartbeatInterval: number;\n  subscriptions: string[];\n}\n\nexport interface EventSubscription {\n  id: string;\n  types: string[];\n  clusterId?: string;\n  callback: (event: KubernetesEvent) => void;\n}\n\n/**\n * WebSocket Event Manager\n * \n * Manages WebSocket connections for real-time Kubernetes event streaming\n */\nexport class KubernetesWebSocketService {\n  private ws: WebSocket | null = null;\n  private config: WebSocketConfig;\n  private subscriptions: Map<string, EventSubscription> = new Map();\n  private isConnected: boolean = false;\n  private reconnectAttempts: number = 0;\n  private heartbeatTimer: NodeJS.Timeout | null = null;\n  private reconnectTimer: NodeJS.Timeout | null = null;\n  private eventQueue: KubernetesEvent[] = [];\n  private connectionPromise: Promise<void> | null = null;\n\n  constructor(config: Partial<WebSocketConfig> = {}) {\n    this.config = {\n      url: config.url || this.getWebSocketUrl(),\n      reconnectInterval: config.reconnectInterval || 5000,\n      maxReconnectAttempts: config.maxReconnectAttempts || 10,\n      heartbeatInterval: config.heartbeatInterval || 30000,\n      subscriptions: config.subscriptions || ['all']\n    };\n  }\n\n  /**\n   * Get WebSocket URL based on current environment\n   */\n  private getWebSocketUrl(): string {\n    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n    const host = window.location.host;\n    return `${protocol}//${host}/api/v1/kubernetes/events/stream`;\n  }\n\n  /**\n   * Connect to WebSocket server\n   */\n  async connect(): Promise<void> {\n    if (this.connectionPromise) {\n      return this.connectionPromise;\n    }\n\n    this.connectionPromise = new Promise((resolve, reject) => {\n      try {\n        const token = localStorage.getItem('access_token');\n        const wsUrl = new URL(this.config.url);\n        if (token) {\n          wsUrl.searchParams.append('token', token);\n        }\n\n        this.ws = new WebSocket(wsUrl.toString());\n\n        this.ws.onopen = () => {\n          console.log('WebSocket connected');\n          this.isConnected = true;\n          this.reconnectAttempts = 0;\n          this.startHeartbeat();\n          this.sendSubscriptions();\n          this.processEventQueue();\n          resolve();\n        };\n\n        this.ws.onmessage = (event) => {\n          this.handleMessage(event);\n        };\n\n        this.ws.onclose = (event) => {\n          console.log('WebSocket closed:', event.code, event.reason);\n          this.isConnected = false;\n          this.stopHeartbeat();\n          \n          if (!event.wasClean && this.reconnectAttempts < this.config.maxReconnectAttempts) {\n            this.scheduleReconnect();\n          }\n        };\n\n        this.ws.onerror = (error) => {\n          console.error('WebSocket error:', error);\n          reject(new Error('WebSocket connection failed'));\n        };\n\n        // Connection timeout\n        setTimeout(() => {\n          if (!this.isConnected) {\n            this.ws?.close();\n            reject(new Error('WebSocket connection timeout'));\n          }\n        }, 10000);\n\n      } catch (error) {\n        reject(error);\n      }\n    });\n\n    return this.connectionPromise;\n  }\n\n  /**\n   * Disconnect from WebSocket server\n   */\n  disconnect(): void {\n    this.stopHeartbeat();\n    this.clearReconnectTimer();\n    \n    if (this.ws) {\n      this.ws.close(1000, 'Client disconnect');\n      this.ws = null;\n    }\n    \n    this.isConnected = false;\n    this.connectionPromise = null;\n  }\n\n  /**\n   * Subscribe to specific event types\n   */\n  subscribe(subscription: Omit<EventSubscription, 'id'>): string {\n    const id = this.generateSubscriptionId();\n    \n    this.subscriptions.set(id, {\n      ...subscription,\n      id\n    });\n\n    // Send subscription to server if connected\n    if (this.isConnected) {\n      this.sendSubscription(id);\n    }\n\n    return id;\n  }\n\n  /**\n   * Unsubscribe from events\n   */\n  unsubscribe(subscriptionId: string): void {\n    this.subscriptions.delete(subscriptionId);\n    \n    // Send unsubscription to server if connected\n    if (this.isConnected) {\n      this.sendUnsubscription(subscriptionId);\n    }\n  }\n\n  /**\n   * Get connection status\n   */\n  isConnectedStatus(): boolean {\n    return this.isConnected;\n  }\n\n  /**\n   * Get number of active subscriptions\n   */\n  getSubscriptionCount(): number {\n    return this.subscriptions.size;\n  }\n\n  /**\n   * Handle incoming WebSocket messages\n   */\n  private handleMessage(event: MessageEvent): void {\n    try {\n      const message = JSON.parse(event.data);\n      \n      switch (message.type) {\n        case 'event':\n          this.handleKubernetesEvent(message.data);\n          break;\n        case 'heartbeat':\n          this.handleHeartbeat();\n          break;\n        case 'error':\n          this.handleError(message.error);\n          break;\n        case 'subscription_ack':\n          this.handleSubscriptionAck(message.subscriptionId);\n          break;\n        default:\n          console.warn('Unknown message type:', message.type);\n      }\n    } catch (error) {\n      console.error('Error parsing WebSocket message:', error);\n    }\n  }\n\n  /**\n   * Handle Kubernetes events\n   */\n  private handleKubernetesEvent(event: KubernetesEvent): void {\n    // Route event to subscribed callbacks\n    this.subscriptions.forEach((subscription) => {\n      if (this.shouldNotifySubscription(subscription, event)) {\n        try {\n          subscription.callback(event);\n        } catch (error) {\n          console.error('Error in subscription callback:', error);\n        }\n      }\n    });\n  }\n\n  /**\n   * Check if subscription should be notified of event\n   */\n  private shouldNotifySubscription(subscription: EventSubscription, event: KubernetesEvent): boolean {\n    // Check event type\n    if (!subscription.types.includes('all') && !subscription.types.includes(event.type)) {\n      return false;\n    }\n\n    // Check cluster ID if specified\n    if (subscription.clusterId && subscription.clusterId !== event.clusterId) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Handle heartbeat messages\n   */\n  private handleHeartbeat(): void {\n    // Server heartbeat received, connection is alive\n  }\n\n  /**\n   * Handle error messages\n   */\n  private handleError(error: any): void {\n    console.error('WebSocket server error:', error);\n  }\n\n  /**\n   * Handle subscription acknowledgment\n   */\n  private handleSubscriptionAck(subscriptionId: string): void {\n    console.log('Subscription acknowledged:', subscriptionId);\n  }\n\n  /**\n   * Start heartbeat mechanism\n   */\n  private startHeartbeat(): void {\n    this.heartbeatTimer = setInterval(() => {\n      if (this.isConnected && this.ws) {\n        this.ws.send(JSON.stringify({ type: 'heartbeat' }));\n      }\n    }, this.config.heartbeatInterval);\n  }\n\n  /**\n   * Stop heartbeat mechanism\n   */\n  private stopHeartbeat(): void {\n    if (this.heartbeatTimer) {\n      clearInterval(this.heartbeatTimer);\n      this.heartbeatTimer = null;\n    }\n  }\n\n  /**\n   * Schedule reconnection attempt\n   */\n  private scheduleReconnect(): void {\n    this.reconnectAttempts++;\n    const delay = Math.min(this.config.reconnectInterval * Math.pow(2, this.reconnectAttempts - 1), 30000);\n    \n    console.log(`Scheduling reconnect attempt ${this.reconnectAttempts} in ${delay}ms`);\n    \n    this.reconnectTimer = setTimeout(() => {\n      this.connectionPromise = null;\n      this.connect().catch((error) => {\n        console.error('Reconnection failed:', error);\n      });\n    }, delay);\n  }\n\n  /**\n   * Clear reconnect timer\n   */\n  private clearReconnectTimer(): void {\n    if (this.reconnectTimer) {\n      clearTimeout(this.reconnectTimer);\n      this.reconnectTimer = null;\n    }\n  }\n\n  /**\n   * Send all subscriptions to server\n   */\n  private sendSubscriptions(): void {\n    this.subscriptions.forEach((subscription, id) => {\n      this.sendSubscription(id);\n    });\n  }\n\n  /**\n   * Send individual subscription to server\n   */\n  private sendSubscription(subscriptionId: string): void {\n    const subscription = this.subscriptions.get(subscriptionId);\n    if (!subscription || !this.ws) return;\n\n    this.ws.send(JSON.stringify({\n      type: 'subscribe',\n      subscriptionId,\n      types: subscription.types,\n      clusterId: subscription.clusterId\n    }));\n  }\n\n  /**\n   * Send unsubscription to server\n   */\n  private sendUnsubscription(subscriptionId: string): void {\n    if (!this.ws) return;\n\n    this.ws.send(JSON.stringify({\n      type: 'unsubscribe',\n      subscriptionId\n    }));\n  }\n\n  /**\n   * Process queued events when connection is established\n   */\n  private processEventQueue(): void {\n    while (this.eventQueue.length > 0) {\n      const event = this.eventQueue.shift();\n      if (event) {\n        this.handleKubernetesEvent(event);\n      }\n    }\n  }\n\n  /**\n   * Generate unique subscription ID\n   */\n  private generateSubscriptionId(): string {\n    return `sub_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n}\n\n// Global WebSocket service instance\nlet globalWebSocketService: KubernetesWebSocketService | null = null;\n\n/**\n * Get global WebSocket service instance\n */\nexport function getWebSocketService(): KubernetesWebSocketService {\n  if (!globalWebSocketService) {\n    globalWebSocketService = new KubernetesWebSocketService();\n  }\n  return globalWebSocketService;\n}\n\n/**\n * Initialize WebSocket service with automatic connection\n */\nexport async function initializeWebSocketService(config?: Partial<WebSocketConfig>): Promise<KubernetesWebSocketService> {\n  const service = new KubernetesWebSocketService(config);\n  \n  try {\n    await service.connect();\n    globalWebSocketService = service;\n    return service;\n  } catch (error) {\n    console.warn('Failed to initialize WebSocket service:', error);\n    return service;\n  }\n}\n\n/**\n * Cleanup WebSocket service\n */\nexport function cleanupWebSocketService(): void {\n  if (globalWebSocketService) {\n    globalWebSocketService.disconnect();\n    globalWebSocketService = null;\n  }\n} "],"names":["KubernetesWebSocketService","cleanupWebSocketService","getWebSocketService","initializeWebSocketService","constructor","config","ws","subscriptions","Map","isConnected","reconnectAttempts","heartbeatTimer","reconnectTimer","eventQueue","connectionPromise","url","getWebSocketUrl","reconnectInterval","maxReconnectAttempts","heartbeatInterval","protocol","window","location","host","connect","Promise","resolve","reject","token","localStorage","getItem","wsUrl","URL","searchParams","append","WebSocket","toString","onopen","console","log","startHeartbeat","sendSubscriptions","processEventQueue","onmessage","event","handleMessage","onclose","code","reason","stopHeartbeat","wasClean","scheduleReconnect","onerror","error","Error","setTimeout","close","disconnect","clearReconnectTimer","subscribe","subscription","id","generateSubscriptionId","set","sendSubscription","unsubscribe","subscriptionId","delete","sendUnsubscription","isConnectedStatus","getSubscriptionCount","size","message","JSON","parse","data","type","handleKubernetesEvent","handleHeartbeat","handleError","handleSubscriptionAck","warn","forEach","shouldNotifySubscription","callback","types","includes","clusterId","setInterval","send","stringify","clearInterval","delay","Math","min","pow","catch","clearTimeout","get","length","shift","Date","now","random","substr","globalWebSocketService","service"],"mappings":"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"}