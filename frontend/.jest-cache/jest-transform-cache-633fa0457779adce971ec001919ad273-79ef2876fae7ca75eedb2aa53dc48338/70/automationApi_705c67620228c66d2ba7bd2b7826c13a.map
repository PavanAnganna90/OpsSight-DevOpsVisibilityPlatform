{"version":3,"sources":["/Users/pavan/Desktop/Devops-app-dev-cursor/frontend/src/services/automationApi.ts"],"sourcesContent":["/**\n * Automation API Service\n * \n * Service for connecting to Ansible automation backend endpoints.\n * Provides methods for fetching coverage data, trends, and automation runs.\n */\n\nimport { \n  AutomationCoverageData, \n  AutomationRun, \n  AutomationStats,\n  AutomationTrend,\n  PlaybookMetrics,\n  HostCoverage,\n  Environment,\n  AutomationFilter\n} from '../types/automation';\n\nexport interface TrendResponse {\n  period: string;\n  start_date: string;\n  end_date: string;\n  data_points: Array<{\n    period: string;\n    timestamp?: string;\n    total_runs: number;\n    success_rate: number;\n    coverage_percentage: number;\n    avg_execution_time: number;\n    total_tasks: number;\n    total_hosts: number;\n    failed_runs: number;\n    module_usage: Record<string, number>;\n  }>;\n  summary: {\n    total_runs: number;\n    avg_coverage: number;\n    avg_success_rate: number;\n    trend_direction: 'improving' | 'declining' | 'stable' | 'insufficient_data' | 'no_data';\n    data_points: number;\n  };\n}\n\nexport interface PerformanceTrendResponse {\n  period: string;\n  start_date: string;\n  end_date: string;\n  performance_data: Array<{\n    period: string;\n    avg_duration_seconds: number;\n    avg_tasks_per_run: number;\n    avg_hosts_per_run: number;\n    success_rate_percent: number;\n    task_efficiency_percent: number;\n    total_runs: number;\n    throughput_runs_per_day?: number;\n  }>;\n  summary: {\n    avg_duration_seconds: number;\n    avg_success_rate_percent: number;\n    total_runs_analyzed: number;\n    performance_trend: 'improving' | 'degrading' | 'stable' | 'insufficient_data' | 'no_data';\n    data_points: number;\n  };\n}\n\nexport interface ModuleTrendResponse {\n  start_date: string;\n  end_date: string;\n  top_modules: Array<{\n    name: string;\n    total_usage: number;\n  }>;\n  time_series: Array<{\n    date: string;\n    total_usage: number;\n    [key: string]: string | number; // module_* properties\n  }>;\n  total_unique_modules: number;\n  analysis_period_days: number;\n}\n\nexport interface HostTrendResponse {\n  start_date: string;\n  end_date: string;\n  coverage_data: Array<{\n    date: string;\n    avg_hosts_per_run: number;\n    avg_successful_hosts: number;\n    avg_failed_hosts: number;\n    host_success_rate_percent: number;\n    total_runs: number;\n  }>;\n  summary: {\n    avg_hosts_per_run: number;\n    avg_host_success_rate_percent: number;\n    total_runs_analyzed: number;\n    data_points: number;\n  };\n}\n\nclass AutomationApiService {\n  private baseUrl: string;\n  \n  constructor() {\n    this.baseUrl = process.env.NODE_ENV === 'production' \n      ? '/api/v1/ansible' \n      : 'http://localhost:8000/api/v1/ansible';\n  }\n\n  private getAuthToken(): string | null {\n    return localStorage.getItem('authToken');\n  }\n\n  private async request<T>(endpoint: string, options: RequestInit = {}): Promise<T> {\n    const token = this.getAuthToken();\n    const url = `${this.baseUrl}${endpoint}`;\n    \n    const defaultHeaders: HeadersInit = {\n      'Content-Type': 'application/json',\n    };\n\n    if (token) {\n      defaultHeaders['Authorization'] = `Bearer ${token}`;\n    }\n\n    const config: RequestInit = {\n      ...options,\n      headers: {\n        ...defaultHeaders,\n        ...options.headers,\n      },\n    };\n\n    try {\n      const response = await fetch(url, config);\n      \n      if (response.status === 401) {\n        throw new Error('Authentication required. Please log in again.');\n      }\n      \n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n      \n      return await response.json();\n    } catch (error) {\n      console.error(`API request failed: ${url}`, error);\n      throw error;\n    }\n  }\n\n  // Legacy coverage endpoint (to maintain compatibility)\n  async getCoverage(projectId: number, filter?: Partial<AutomationFilter>): Promise<AutomationCoverageData> {\n    const queryParams = new URLSearchParams();\n    queryParams.append('project_id', projectId.toString());\n    \n    if (filter?.environment?.length) {\n      filter.environment.forEach(env => queryParams.append('environment', env));\n    }\n    \n    if (filter?.date_range) {\n      queryParams.append('start_date', filter.date_range.start);\n      queryParams.append('end_date', filter.date_range.end);\n    }\n\n    return this.request<AutomationCoverageData>(`/coverage?${queryParams}`);\n  }\n\n  // New trend analysis endpoints\n  async getCoverageTrends(\n    projectId: number, \n    period: 'daily' | 'weekly' | 'monthly' = 'daily',\n    daysBack: number = 30,\n    hostFilter?: string,\n    moduleFilter?: string\n  ): Promise<TrendResponse> {\n    const queryParams = new URLSearchParams();\n    queryParams.append('project_id', projectId.toString());\n    queryParams.append('period', period);\n    queryParams.append('days_back', daysBack.toString());\n    \n    if (hostFilter) queryParams.append('host_filter', hostFilter);\n    if (moduleFilter) queryParams.append('module_filter', moduleFilter);\n\n    return this.request<TrendResponse>(`/trends/coverage?${queryParams}`);\n  }\n\n  async getPerformanceTrends(\n    projectId: number,\n    period: 'daily' | 'weekly' | 'monthly' = 'daily',\n    daysBack: number = 30\n  ): Promise<PerformanceTrendResponse> {\n    const queryParams = new URLSearchParams();\n    queryParams.append('project_id', projectId.toString());\n    queryParams.append('period', period);\n    queryParams.append('days_back', daysBack.toString());\n\n    return this.request<PerformanceTrendResponse>(`/trends/performance?${queryParams}`);\n  }\n\n  async getModuleUsageTrends(\n    projectId: number,\n    daysBack: number = 30,\n    topN: number = 10\n  ): Promise<ModuleTrendResponse> {\n    const queryParams = new URLSearchParams();\n    queryParams.append('project_id', projectId.toString());\n    queryParams.append('days_back', daysBack.toString());\n    queryParams.append('top_n', topN.toString());\n\n    return this.request<ModuleTrendResponse>(`/trends/modules?${queryParams}`);\n  }\n\n  async getHostCoverageTrends(\n    projectId: number,\n    daysBack: number = 30\n  ): Promise<HostTrendResponse> {\n    const queryParams = new URLSearchParams();\n    queryParams.append('project_id', projectId.toString());\n    queryParams.append('days_back', daysBack.toString());\n\n    return this.request<HostTrendResponse>(`/trends/hosts?${queryParams}`);\n  }\n\n  // Automation runs management\n  async getAutomationRuns(filter?: {\n    projectId?: number;\n    status?: string;\n    automationType?: string;\n    hostFilter?: string;\n    playbookName?: string;\n    skip?: number;\n    limit?: number;\n  }): Promise<{\n    automation_runs: AutomationRun[];\n    total: number;\n    skip: number;\n    limit: number;\n    filters: Record<string, any>;\n  }> {\n    const queryParams = new URLSearchParams();\n    \n    if (filter?.projectId) queryParams.append('project_id', filter.projectId.toString());\n    if (filter?.status) queryParams.append('status', filter.status);\n    if (filter?.automationType) queryParams.append('automation_type', filter.automationType);\n    if (filter?.hostFilter) queryParams.append('host_filter', filter.hostFilter);\n    if (filter?.playbookName) queryParams.append('playbook_name', filter.playbookName);\n    if (filter?.skip) queryParams.append('skip', filter.skip.toString());\n    if (filter?.limit) queryParams.append('limit', filter.limit.toString());\n\n    return this.request(`/automation-runs?${queryParams}`);\n  }\n\n  async getAutomationRun(\n    runId: number,\n    includeLogs: boolean = false,\n    includeCoverage: boolean = true\n  ): Promise<AutomationRun> {\n    const queryParams = new URLSearchParams();\n    queryParams.append('include_logs', includeLogs.toString());\n    queryParams.append('include_coverage', includeCoverage.toString());\n\n    return this.request<AutomationRun>(`/automation-runs/${runId}?${queryParams}`);\n  }\n\n  // Statistics\n  async getStats(projectId: number): Promise<AutomationStats> {\n    const queryParams = new URLSearchParams();\n    queryParams.append('project_id', projectId.toString());\n\n    return this.request<AutomationStats>(`/stats?${queryParams}`);\n  }\n\n  // Log parsing\n  async parseLog(\n    logContent: string,\n    projectId?: number,\n    playbookName?: string,\n    environment?: string,\n    logFormat: string = 'auto'\n  ): Promise<{\n    success: boolean;\n    format: string;\n    plays: any[];\n    tasks: any[];\n    hosts: Record<string, any>;\n    summary: Record<string, any>;\n    coverage_metrics: Record<string, any>;\n    metadata: Record<string, any>;\n    errors: string[];\n    warnings: string[];\n    automation_run_id?: number;\n  }> {\n    return this.request('/parse-log', {\n      method: 'POST',\n      body: JSON.stringify({\n        log_content: logContent,\n        project_id: projectId,\n        playbook_name: playbookName,\n        environment,\n        log_format: logFormat\n      })\n    });\n  }\n\n  async parseLogFile(\n    file: File,\n    projectId?: number,\n    playbookName?: string,\n    environment?: string,\n    logFormat: string = 'auto'\n  ): Promise<{\n    success: boolean;\n    format: string;\n    plays: any[];\n    tasks: any[];\n    hosts: Record<string, any>;\n    summary: Record<string, any>;\n    coverage_metrics: Record<string, any>;\n    metadata: Record<string, any>;\n    errors: string[];\n    warnings: string[];\n    automation_run_id?: number;\n  }> {\n    const formData = new FormData();\n    formData.append('file', file);\n    if (projectId) formData.append('project_id', projectId.toString());\n    if (playbookName) formData.append('playbook_name', playbookName);\n    if (environment) formData.append('environment', environment);\n    formData.append('log_format', logFormat);\n\n    return this.request('/parse-log-file', {\n      method: 'POST',\n      body: formData,\n      headers: {} // Don't set Content-Type for FormData\n    });\n  }\n\n  // Utility endpoints\n  async getSupportedModules(): Promise<{\n    automation_modules: string[];\n    critical_modules: string[];\n    total_supported: number;\n    categories: Record<string, string[]>;\n  }> {\n    return this.request('/supported-modules');\n  }\n\n  async getTaskStatuses(): Promise<{\n    task_statuses: string[];\n    host_statuses: string[];\n    automation_statuses: string[];\n    automation_types: string[];\n  }> {\n    return this.request('/task-statuses');\n  }\n\n  // Status check\n  async getStatus(): Promise<{\n    status: string;\n    features: Record<string, boolean>;\n    supported_formats: string[];\n    supported_modules: string[];\n    critical_modules: string[];\n    version: string;\n  }> {\n    return this.request('/status');\n  }\n\n  // New endpoints for coverage view component\n  async getPlaybookMetrics(projectId: number): Promise<PlaybookMetrics[]> {\n    return this.request(`/playbook-metrics?project_id=${projectId}`);\n  }\n\n  async getHostCoverage(projectId: number): Promise<HostCoverage[]> {\n    return this.request(`/host-coverage?project_id=${projectId}`);\n  }\n\n  async getEnvironments(projectId: number): Promise<Environment[]> {\n    return this.request(`/environments?project_id=${projectId}`);\n  }\n\n  async getRecentRuns(projectId: number, limit: number = 10): Promise<{\n    automation_runs: AutomationRun[];\n    total: number;\n    page: number;\n    pages: number;\n    limit: number;\n  }> {\n    return this.request(`/automation-runs?project_id=${projectId}&limit=${limit}`);\n  }\n}\n\n// Export singleton instance\nexport const automationApi = new AutomationApiService();\nexport default automationApi; "],"names":["automationApi","AutomationApiService","constructor","baseUrl","process","env","NODE_ENV","getAuthToken","localStorage","getItem","request","endpoint","options","token","url","defaultHeaders","config","headers","response","fetch","status","Error","ok","statusText","json","error","console","getCoverage","projectId","filter","queryParams","URLSearchParams","append","toString","environment","length","forEach","date_range","start","end","getCoverageTrends","period","daysBack","hostFilter","moduleFilter","getPerformanceTrends","getModuleUsageTrends","topN","getHostCoverageTrends","getAutomationRuns","automationType","playbookName","skip","limit","getAutomationRun","runId","includeLogs","includeCoverage","getStats","parseLog","logContent","logFormat","method","body","JSON","stringify","log_content","project_id","playbook_name","log_format","parseLogFile","file","formData","FormData","getSupportedModules","getTaskStatuses","getStatus","getPlaybookMetrics","getHostCoverage","getEnvironments","getRecentRuns"],"mappings":"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"}