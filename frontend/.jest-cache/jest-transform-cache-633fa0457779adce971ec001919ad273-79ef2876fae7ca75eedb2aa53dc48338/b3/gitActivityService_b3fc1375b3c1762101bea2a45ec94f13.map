{"version":3,"sources":["/Users/pavan/Desktop/Devops-app-dev-cursor/frontend/src/services/gitActivityService.ts"],"sourcesContent":["/**\n * Git Activity Service\n * \n * API service for Git activity data, heatmaps, and analytics.\n */\n\nimport axios, { AxiosResponse } from 'axios';\nimport {\n  GitActivityRequest,\n  GitActivityResponse,\n  ActivityHeatmapData,\n  GitActivityError,\n  GitActivityApiService\n} from '../types/git-activity';\n\n// API base URL - should be configured based on environment\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000/api/v1';\n\n/**\n * Git Activity API Service Implementation\n */\nclass GitActivityService implements GitActivityApiService {\n  private baseURL: string;\n\n  constructor(baseURL?: string) {\n    this.baseURL = baseURL || API_BASE_URL;\n  }\n\n  /**\n   * Get comprehensive Git activity data for a repository\n   */\n  async getRepositoryActivity(request: GitActivityRequest): Promise<GitActivityResponse> {\n    try {\n      const params = {\n        provider: request.provider,\n        days_back: request.days_back,\n        use_cache: request.use_cache,\n        force_refresh: request.force_refresh\n      };\n\n      const response: AxiosResponse<GitActivityResponse> = await axios.get(\n        `${this.baseURL}/git/activity/${request.owner}/${request.repo}`,\n        { params }\n      );\n\n      return response.data;\n    } catch (error) {\n      throw this.handleError(error, 'Failed to fetch repository activity');\n    }\n  }\n\n  /**\n   * Get activity heatmap data for a repository\n   */\n  async getRepositoryHeatmap(\n    owner: string, \n    repo: string, \n    daysBack: number = 365\n  ): Promise<ActivityHeatmapData[]> {\n    try {\n      const response: AxiosResponse<{ heatmap: ActivityHeatmapData[] }> = await axios.get(\n        `${this.baseURL}/git/heatmap/${owner}/${repo}`,\n        { \n          params: { days_back: daysBack }\n        }\n      );\n\n      return response.data.heatmap;\n    } catch (error) {\n      throw this.handleError(error, 'Failed to fetch repository heatmap');\n    }\n  }\n\n  /**\n   * Get repository metrics\n   */\n  async getRepositoryMetrics(owner: string, repo: string): Promise<any> {\n    try {\n      const response: AxiosResponse<any> = await axios.get(\n        `${this.baseURL}/git/metrics/${owner}/${repo}`\n      );\n\n      return response.data;\n    } catch (error) {\n      throw this.handleError(error, 'Failed to fetch repository metrics');\n    }\n  }\n\n  /**\n   * Get repository contributors\n   */\n  async getRepositoryContributors(owner: string, repo: string): Promise<any> {\n    try {\n      const response: AxiosResponse<any> = await axios.get(\n        `${this.baseURL}/git/contributors/${owner}/${repo}`\n      );\n\n      return response.data;\n    } catch (error) {\n      throw this.handleError(error, 'Failed to fetch repository contributors');\n    }\n  }\n\n  /**\n   * Get velocity trends\n   */\n  async getVelocityTrends(owner: string, repo: string): Promise<any> {\n    try {\n      const response: AxiosResponse<any> = await axios.get(\n        `${this.baseURL}/git/velocity/${owner}/${repo}`\n      );\n\n      return response.data;\n    } catch (error) {\n      throw this.handleError(error, 'Failed to fetch velocity trends');\n    }\n  }\n\n  /**\n   * Invalidate cache for a repository\n   */\n  async invalidateCache(owner: string, repo: string): Promise<void> {\n    try {\n      await axios.delete(`${this.baseURL}/git/cache/${owner}/${repo}`);\n    } catch (error) {\n      throw this.handleError(error, 'Failed to invalidate cache');\n    }\n  }\n\n  /**\n   * Get cache statistics\n   */\n  async getCacheStats(): Promise<any> {\n    try {\n      const response: AxiosResponse<any> = await axios.get(\n        `${this.baseURL}/git/cache/stats`\n      );\n\n      return response.data;\n    } catch (error) {\n      throw this.handleError(error, 'Failed to fetch cache stats');\n    }\n  }\n\n  /**\n   * Warm cache for multiple repositories\n   */\n  async warmCache(repositories: Array<{ owner: string; repo: string }>): Promise<void> {\n    try {\n      await axios.post(`${this.baseURL}/git/cache/warm`, { repositories });\n    } catch (error) {\n      throw this.handleError(error, 'Failed to warm cache');\n    }\n  }\n\n  /**\n   * Cleanup expired cache entries\n   */\n  async cleanupCache(): Promise<void> {\n    try {\n      await axios.post(`${this.baseURL}/git/cache/cleanup`);\n    } catch (error) {\n      throw this.handleError(error, 'Failed to cleanup cache');\n    }\n  }\n\n  /**\n   * Search repositories by organization\n   */\n  async searchRepositories(query: string, provider: 'github' | 'gitlab' = 'github'): Promise<any> {\n    try {\n      const response: AxiosResponse<any> = await axios.get(\n        `${this.baseURL}/git/search`,\n        { \n          params: { query, provider }\n        }\n      );\n\n      return response.data;\n    } catch (error) {\n      throw this.handleError(error, 'Failed to search repositories');\n    }\n  }\n\n  /**\n   * Get webhook configuration status\n   */\n  async getWebhookStatus(owner: string, repo: string): Promise<any> {\n    try {\n      const response: AxiosResponse<any> = await axios.get(\n        `${this.baseURL}/webhooks/status/${owner}/${repo}`\n      );\n\n      return response.data;\n    } catch (error) {\n      throw this.handleError(error, 'Failed to fetch webhook status');\n    }\n  }\n\n  /**\n   * Configure webhook for real-time updates\n   */\n  async configureWebhook(\n    owner: string, \n    repo: string, \n    provider: 'github' | 'gitlab'\n  ): Promise<any> {\n    try {\n      const response: AxiosResponse<any> = await axios.post(\n        `${this.baseURL}/webhooks/configure`,\n        { owner, repo, provider }\n      );\n\n      return response.data;\n    } catch (error) {\n      throw this.handleError(error, 'Failed to configure webhook');\n    }\n  }\n\n  /**\n   * Export activity data in various formats\n   */\n  async exportActivity(\n    owner: string,\n    repo: string,\n    format: 'csv' | 'json' | 'pdf',\n    options?: any\n  ): Promise<Blob> {\n    try {\n      const response: AxiosResponse<Blob> = await axios.get(\n        `${this.baseURL}/git/export/${owner}/${repo}`,\n        {\n          params: { format, ...options },\n          responseType: 'blob'\n        }\n      );\n\n      return response.data;\n    } catch (error) {\n      throw this.handleError(error, 'Failed to export activity data');\n    }\n  }\n\n  /**\n   * Handle API errors and convert to GitActivityError\n   */\n  private handleError(error: any, message: string): GitActivityError {\n    const gitError: GitActivityError = {\n      type: 'network',\n      message,\n      timestamp: new Date().toISOString()\n    };\n\n    if (axios.isAxiosError(error)) {\n      if (error.response) {\n        // Server responded with error status\n        gitError.type = this.getErrorType(error.response.status);\n        gitError.message = error.response.data?.message || error.response.data?.detail || message;\n        gitError.details = error.response.data;\n      } else if (error.request) {\n        // Request made but no response\n        gitError.type = 'network';\n        gitError.message = 'Network error: No response from server';\n      } else {\n        // Something else happened\n        gitError.type = 'network';\n        gitError.message = error.message || message;\n      }\n    } else {\n      gitError.details = error;\n    }\n\n    return gitError;\n  }\n\n  /**\n   * Determine error type based on HTTP status code\n   */\n  private getErrorType(status: number): GitActivityError['type'] {\n    if (status === 401 || status === 403) return 'auth';\n    if (status === 400 || status === 422) return 'validation';\n    if (status >= 500) return 'server';\n    return 'network';\n  }\n}\n\n// Create and export singleton instance\nconst gitActivityService = new GitActivityService();\n\nexport default gitActivityService;\n\n// Export class for testing\nexport { GitActivityService };\n\n// Utility functions for data processing\nexport const processHeatmapData = (data: ActivityHeatmapData[]): ActivityHeatmapData[] => {\n  // Sort by date\n  return data.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());\n};\n\nexport const fillMissingDates = (\n  data: ActivityHeatmapData[],\n  startDate: Date,\n  endDate: Date\n): ActivityHeatmapData[] => {\n  const filled: ActivityHeatmapData[] = [];\n  const dataMap = new Map(data.map(item => [item.date, item]));\n  \n  const currentDate = new Date(startDate);\n  while (currentDate <= endDate) {\n    const dateStr = currentDate.toISOString().split('T')[0];\n    \n    if (dataMap.has(dateStr)) {\n      filled.push(dataMap.get(dateStr)!);\n    } else {\n      // Fill missing date with zero activity\n      filled.push({\n        date: dateStr,\n        activity_count: 0,\n        commit_count: 0,\n        pr_count: 0,\n        contributor_count: 0,\n        lines_added: 0,\n        lines_deleted: 0,\n        files_changed: 0,\n        activity_types: []\n      });\n    }\n    \n    currentDate.setDate(currentDate.getDate() + 1);\n  }\n  \n  return filled;\n};\n\nexport const calculateActivityLevel = (activityCount: number, maxActivity: number): 0 | 1 | 2 | 3 | 4 => {\n  if (activityCount === 0) return 0;\n  if (maxActivity === 0) return 1;\n  \n  const ratio = activityCount / maxActivity;\n  if (ratio <= 0.25) return 1;\n  if (ratio <= 0.5) return 2;\n  if (ratio <= 0.75) return 3;\n  return 4;\n}; "],"names":["GitActivityService","calculateActivityLevel","fillMissingDates","processHeatmapData","API_BASE_URL","process","env","NEXT_PUBLIC_API_URL","constructor","baseURL","getRepositoryActivity","request","params","provider","days_back","use_cache","force_refresh","response","axios","get","owner","repo","data","error","handleError","getRepositoryHeatmap","daysBack","heatmap","getRepositoryMetrics","getRepositoryContributors","getVelocityTrends","invalidateCache","delete","getCacheStats","warmCache","repositories","post","cleanupCache","searchRepositories","query","getWebhookStatus","configureWebhook","exportActivity","format","options","responseType","message","gitError","type","timestamp","Date","toISOString","isAxiosError","getErrorType","status","detail","details","gitActivityService","sort","a","b","date","getTime","startDate","endDate","filled","dataMap","Map","map","item","currentDate","dateStr","split","has","push","activity_count","commit_count","pr_count","contributor_count","lines_added","lines_deleted","files_changed","activity_types","setDate","getDate","activityCount","maxActivity","ratio"],"mappings":"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"}