{"version":3,"sources":["/Users/pavan/Desktop/Devops-app-dev-cursor/frontend/src/components/admin/RoleCreateModal.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\n\nconst SYSTEM_ROLE_OPTIONS = [\n  { value: 'super_admin', label: 'Super Admin' },\n  { value: 'org_owner', label: 'Organization Owner' },\n  { value: 'devops_admin', label: 'DevOps Admin' },\n  { value: 'manager', label: 'Manager' },\n  { value: 'engineer', label: 'Engineer' },\n  { value: 'viewer', label: 'Viewer' },\n  { value: 'api_only', label: 'API Only' },\n];\n\n/**\n * RoleCreateModal - Modal dialog for creating a new role.\n * Accessibility and UI polish improvements included.\n */\nconst RoleCreateModal = ({ open, onClose, onCreate, creationLoading = false, creationError = '', onSuccess }: {\n  open: boolean;\n  onClose: () => void;\n  onCreate: (role: { name: string; display_name: string; description?: string; permission_ids?: number[] }) => Promise<void> | void;\n  creationLoading?: boolean;\n  creationError?: string;\n  onSuccess?: () => void;\n}) => {\n  const [name, setName] = useState('');\n  const [displayName, setDisplayName] = useState('');\n  const [description, setDescription] = useState('');\n  const [error, setError] = useState('');\n  const [permissions, setPermissions] = useState<any[]>([]);\n  const [selectedPermissions, setSelectedPermissions] = useState<number[]>([]);\n  const [loadingPerms, setLoadingPerms] = useState(false);\n  const [permError, setPermError] = useState('');\n  const firstInputRef = useRef<HTMLInputElement>(null);\n\n  // Focus trap: focus first input on open\n  useEffect(() => {\n    if (open && firstInputRef.current) {\n      firstInputRef.current.focus();\n    }\n  }, [open]);\n\n  // Fetch permissions on open\n  useEffect(() => {\n    if (!open) return;\n    setLoadingPerms(true);\n    setPermError('');\n    fetch('/api/v1/permissions')\n      .then(res => res.json())\n      .then(data => setPermissions(data))\n      .catch(() => setPermError('Failed to load permissions'))\n      .finally(() => setLoadingPerms(false));\n  }, [open]);\n\n  const handlePermChange = (id: number) => {\n    setSelectedPermissions(prev =>\n      prev.includes(id) ? prev.filter(pid => pid !== id) : [...prev, id]\n    );\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!name) {\n      setError('Role type is required');\n      return;\n    }\n    if (!displayName.trim()) {\n      setError('Display name is required');\n      return;\n    }\n    setError('');\n    await onCreate({\n      name,\n      display_name: displayName.trim(),\n      description: description.trim(),\n      permission_ids: selectedPermissions\n    });\n    setName('');\n    setDisplayName('');\n    setDescription('');\n    setSelectedPermissions([]);\n    if (onSuccess) onSuccess();\n  };\n\n  // Group permissions by category\n  const groupedPermissions = permissions.reduce((acc: any, perm: any) => {\n    if (!acc[perm.category]) acc[perm.category] = [];\n    acc[perm.category].push(perm);\n    return acc;\n  }, {});\n\n  if (!open) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 transition-opacity duration-200\">\n      <div\n        className=\"bg-white dark:bg-gray-900 rounded-lg shadow-lg p-6 w-full max-w-md overflow-y-auto max-h-[90vh] transition-all duration-200 scale-100 animate-fade-in\"\n        role=\"dialog\"\n        aria-modal=\"true\"\n        aria-labelledby=\"role-create-modal-title\"\n      >\n        <h2 id=\"role-create-modal-title\" className=\"text-lg font-bold mb-4\">Create New Role</h2>\n        <form onSubmit={handleSubmit}>\n          <div className=\"mb-4\">\n            <label htmlFor=\"role-type\" className=\"block font-medium mb-1\">Role Type</label>\n            <select\n              id=\"role-type\"\n              className=\"w-full border rounded px-3 py-2 dark:bg-gray-800 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500\"\n              value={name}\n              onChange={e => setName(e.target.value)}\n              required\n              disabled={creationLoading}\n            >\n              <option value=\"\">Select a role type...</option>\n              {SYSTEM_ROLE_OPTIONS.map(opt => (\n                <option key={opt.value} value={opt.value}>{opt.label}</option>\n              ))}\n            </select>\n          </div>\n          <div className=\"mb-4\">\n            <label htmlFor=\"display-name\" className=\"block font-medium mb-1\">Display Name</label>\n            <input\n              id=\"display-name\"\n              className=\"w-full border rounded px-3 py-2 dark:bg-gray-800 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500\"\n              value={displayName}\n              onChange={e => setDisplayName(e.target.value)}\n              required\n              disabled={creationLoading}\n              ref={firstInputRef}\n              autoFocus\n            />\n          </div>\n          <div className=\"mb-4\">\n            <label htmlFor=\"description\" className=\"block font-medium mb-1\">Description</label>\n            <textarea\n              id=\"description\"\n              className=\"w-full border rounded px-3 py-2 dark:bg-gray-800 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500\"\n              value={description}\n              onChange={e => setDescription(e.target.value)}\n              rows={3}\n              disabled={creationLoading}\n            />\n          </div>\n          <div className=\"mb-4\">\n            <label className=\"block font-medium mb-1\">Permissions</label>\n            {loadingPerms ? (\n              <div className=\"text-gray-500\">Loading permissions...</div>\n            ) : permError ? (\n              <div className=\"text-red-500\">{permError}</div>\n            ) : (\n              <div className=\"max-h-40 overflow-y-auto border rounded p-2 bg-gray-50 dark:bg-gray-800\">\n                {Object.keys(groupedPermissions).map(category => (\n                  <div key={category} className=\"mb-2\">\n                    <div className=\"font-semibold text-xs text-gray-700 dark:text-gray-300 mb-1\">{category}</div>\n                    {groupedPermissions[category].map((perm: any) => (\n                      <label key={perm.id} className=\"flex items-center gap-2 text-sm mb-1\">\n                        <input\n                          type=\"checkbox\"\n                          checked={selectedPermissions.includes(perm.id)}\n                          onChange={() => handlePermChange(perm.id)}\n                          disabled={creationLoading}\n                          className=\"focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500\"\n                        />\n                        {perm.display_name}\n                      </label>\n                    ))}\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n          <div aria-live=\"polite\">\n            {(error || creationError) && <div className=\"text-red-500 mb-2\">{error || creationError}</div>}\n          </div>\n          <div className=\"flex justify-end gap-2\">\n            <button\n              type=\"button\"\n              className=\"px-4 py-2 rounded bg-gray-200 dark:bg-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500\"\n              onClick={onClose}\n              disabled={creationLoading}\n            >\n              Cancel\n            </button>\n            <button\n              type=\"submit\"\n              className=\"px-4 py-2 rounded bg-blue-600 text-white flex items-center focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500\"\n              disabled={creationLoading}\n            >\n              {creationLoading && <span className=\"animate-spin mr-2 w-4 h-4 border-2 border-white border-t-transparent rounded-full\"></span>}\n              Create\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default RoleCreateModal; "],"names":["SYSTEM_ROLE_OPTIONS","value","label","RoleCreateModal","open","onClose","onCreate","creationLoading","creationError","onSuccess","name","setName","useState","displayName","setDisplayName","description","setDescription","error","setError","permissions","setPermissions","selectedPermissions","setSelectedPermissions","loadingPerms","setLoadingPerms","permError","setPermError","firstInputRef","useRef","useEffect","current","focus","fetch","then","res","json","data","catch","finally","handlePermChange","id","prev","includes","filter","pid","handleSubmit","e","preventDefault","trim","display_name","permission_ids","groupedPermissions","reduce","acc","perm","category","push","div","className","role","aria-modal","aria-labelledby","h2","form","onSubmit","htmlFor","select","onChange","target","required","disabled","option","map","opt","input","ref","autoFocus","textarea","rows","Object","keys","type","checked","aria-live","button","onClick","span"],"mappings":"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"}