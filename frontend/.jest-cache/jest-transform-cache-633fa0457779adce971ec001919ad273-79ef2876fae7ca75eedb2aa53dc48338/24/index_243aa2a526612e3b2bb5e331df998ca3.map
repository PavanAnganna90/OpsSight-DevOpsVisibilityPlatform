{"version":3,"sources":["/Users/pavan/Desktop/Devops-app-dev-cursor/frontend/src/pages/admin/roles/index.tsx"],"sourcesContent":["/**\n * Role Management Admin Page\n * \n * Comprehensive interface for managing roles, permissions, and user assignments.\n * Provides full RBAC administration capabilities for system administrators.\n */\n\n'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport {\n  UserGroupIcon,\n  PlusIcon,\n  PencilIcon,\n  TrashIcon,\n  ShieldCheckIcon,\n  UsersIcon,\n  EyeIcon,\n  Cog6ToothIcon,\n  CheckCircleIcon,\n  XCircleIcon,\n  ExclamationTriangleIcon\n} from '@heroicons/react/24/outline';\n\nimport { Button } from '@/components/ui/Button';\nimport { DashboardCard } from '@/components/layout/DashboardCard';\nimport { StatusIndicator } from '@/components/ui/StatusIndicator';\nimport { TextField } from '@/components/ui/TextField';\nimport { Select } from '@/components/ui/Select';\nimport { withAdminAccess } from '@/components/rbac/withPermissions';\nimport { useAdminPermissions } from '@/hooks/usePermissions';\nimport { PermissionGuard } from '@/components/rbac/PermissionGuard';\nimport { Checkbox } from '@/components/ui/Checkbox';\nimport { Modal } from '@/components/ui/Modal';\nimport { Toast } from '@/components/ui/Toast';\n\n// Types\ninterface Role {\n  id: string;\n  name: string;\n  display_name: string;\n  description: string;\n  priority: number;\n  is_system_role: boolean;\n  organization_id?: string;\n  permissions: Permission[];\n  user_count: number;\n  created_at: string;\n  updated_at: string;\n}\n\ninterface Permission {\n  id: string;\n  name: string;\n  display_name: string;\n  description: string;\n  category: string;\n  is_system_permission: boolean;\n  organization_id?: string;\n}\n\ninterface PermissionCategory {\n  name: string;\n  permissions: Permission[];\n}\n\ninterface RoleFormData {\n  name: string;\n  display_name: string;\n  description: string;\n  priority: number;\n  organization_id?: string;\n  permission_ids: string[];\n}\n\nfunction RoleManagementPage() {\n  const queryClient = useQueryClient();\n  const adminPerms = useAdminPermissions();\n  const [selectedRole, setSelectedRole] = useState<Role | null>(null);\n  \n  // Check if user can manage roles\n  if (!adminPerms.canManageRoles) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center\">\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Access Denied</h2>\n          <p className=\"text-gray-600\">You don't have permission to manage roles.</p>\n        </div>\n      </div>\n    );\n  }\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\n  const [showPermissionsModal, setShowPermissionsModal] = useState(false);\n  const [toast, setToast] = useState<{\n    message: string;\n    type: 'success' | 'error' | 'warning';\n    show: boolean;\n  }>({ message: '', type: 'success', show: false });\n\n  // Fetch roles\n  const { data: roles, isLoading: rolesLoading, error: rolesError } = useQuery({\n    queryKey: ['roles'],\n    queryFn: async () => {\n      const response = await fetch('/api/v1/roles/', {\n        headers: {\n          'Authorization': `Bearer ${localStorage.getItem('token')}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to fetch roles');\n      return response.json();\n    },\n  });\n\n  // Fetch permissions\n  const { data: permissions, isLoading: permissionsLoading } = useQuery({\n    queryKey: ['permissions'],\n    queryFn: async () => {\n      const response = await fetch('/api/v1/permissions/', {\n        headers: {\n          'Authorization': `Bearer ${localStorage.getItem('token')}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to fetch permissions');\n      return response.json();\n    },\n  });\n\n  // Fetch permission categories\n  const { data: permissionCategories } = useQuery({\n    queryKey: ['permission-categories'],\n    queryFn: async () => {\n      const response = await fetch('/api/v1/permissions/categories/all', {\n        headers: {\n          'Authorization': `Bearer ${localStorage.getItem('token')}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to fetch permission categories');\n      return response.json();\n    },\n  });\n\n  // Create role mutation\n  const createRoleMutation = useMutation({\n    mutationFn: async (roleData: RoleFormData) => {\n      const response = await fetch('/api/v1/roles/', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${localStorage.getItem('token')}`,\n        },\n        body: JSON.stringify(roleData),\n      });\n      if (!response.ok) throw new Error('Failed to create role');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['roles'] });\n      setShowCreateModal(false);\n      showToast('Role created successfully', 'success');\n    },\n    onError: (error) => {\n      showToast(`Failed to create role: ${error.message}`, 'error');\n    },\n  });\n\n  // Update role mutation\n  const updateRoleMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<RoleFormData> }) => {\n      const response = await fetch(`/api/v1/roles/${id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${localStorage.getItem('token')}`,\n        },\n        body: JSON.stringify(data),\n      });\n      if (!response.ok) throw new Error('Failed to update role');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['roles'] });\n      setShowEditModal(false);\n      showToast('Role updated successfully', 'success');\n    },\n    onError: (error) => {\n      showToast(`Failed to update role: ${error.message}`, 'error');\n    },\n  });\n\n  // Delete role mutation\n  const deleteRoleMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const response = await fetch(`/api/v1/roles/${id}`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${localStorage.getItem('token')}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to delete role');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['roles'] });\n      setShowDeleteModal(false);\n      setSelectedRole(null);\n      showToast('Role deleted successfully', 'success');\n    },\n    onError: (error) => {\n      showToast(`Failed to delete role: ${error.message}`, 'error');\n    },\n  });\n\n  // Assign permissions mutation\n  const assignPermissionsMutation = useMutation({\n    mutationFn: async ({ roleId, permissionIds }: { roleId: string; permissionIds: string[] }) => {\n      const response = await fetch(`/api/v1/permissions/roles/${roleId}/assign`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${localStorage.getItem('token')}`,\n        },\n        body: JSON.stringify({ permission_ids: permissionIds }),\n      });\n      if (!response.ok) throw new Error('Failed to assign permissions');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['roles'] });\n      setShowPermissionsModal(false);\n      showToast('Permissions updated successfully', 'success');\n    },\n    onError: (error) => {\n      showToast(`Failed to update permissions: ${error.message}`, 'error');\n    },\n  });\n\n  const showToast = (message: string, type: 'success' | 'error' | 'warning') => {\n    setToast({ message, type, show: true });\n    setTimeout(() => setToast(prev => ({ ...prev, show: false })), 5000);\n  };\n\n  const getRolePriorityColor = (priority: number) => {\n    if (priority >= 90) return 'text-red-500';\n    if (priority >= 70) return 'text-orange-500';\n    if (priority >= 50) return 'text-yellow-500';\n    return 'text-green-500';\n  };\n\n  const getRoleStatusColor = (isSystemRole: boolean) => {\n    return isSystemRole ? 'text-blue-500' : 'text-gray-500';\n  };\n\n  if (rolesLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-900 p-6\">\n        <div className=\"max-w-7xl mx-auto\">\n          <div className=\"animate-pulse\">\n            <div className=\"h-8 bg-gray-700 rounded w-1/4 mb-6\"></div>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n              {[1, 2, 3].map((i) => (\n                <div key={i} className=\"h-48 bg-gray-800 rounded-lg\"></div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (rolesError) {\n    return (\n      <div className=\"min-h-screen bg-gray-900 p-6\">\n        <div className=\"max-w-7xl mx-auto\">\n          <div className=\"text-center\">\n            <XCircleIcon className=\"h-16 w-16 text-red-500 mx-auto mb-4\" />\n            <h1 className=\"text-2xl font-bold text-white mb-2\">Error Loading Roles</h1>\n            <p className=\"text-gray-400\">Failed to load role data. Please try again.</p>\n            <Button\n              onClick={() => window.location.reload()}\n              variant=\"primary\"\n              className=\"mt-4\"\n            >\n              Reload Page\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-900 p-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        {/* Header */}\n        <div className=\"flex justify-between items-center mb-8\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-white flex items-center\">\n              <UserGroupIcon className=\"h-8 w-8 mr-3 text-blue-500\" />\n              Role Management\n            </h1>\n            <p className=\"text-gray-400 mt-2\">\n              Manage roles, permissions, and access control for your organization\n            </p>\n          </div>\n          <Button\n            onClick={() => setShowCreateModal(true)}\n            variant=\"primary\"\n            leftIcon={<PlusIcon className=\"h-5 w-5\" />}\n          >\n            Create Role\n          </Button>\n        </div>\n\n        {/* Stats Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n          <DashboardCard>\n            <div className=\"flex items-center\">\n              <div className=\"p-3 bg-blue-500/10 rounded-lg\">\n                <UserGroupIcon className=\"h-6 w-6 text-blue-500\" />\n              </div>\n              <div className=\"ml-4\">\n                <p className=\"text-sm text-gray-400\">Total Roles</p>\n                <p className=\"text-2xl font-bold text-white\">{roles?.length || 0}</p>\n              </div>\n            </div>\n          </DashboardCard>\n\n          <DashboardCard>\n            <div className=\"flex items-center\">\n              <div className=\"p-3 bg-green-500/10 rounded-lg\">\n                <ShieldCheckIcon className=\"h-6 w-6 text-green-500\" />\n              </div>\n              <div className=\"ml-4\">\n                <p className=\"text-sm text-gray-400\">System Roles</p>\n                <p className=\"text-2xl font-bold text-white\">\n                  {roles?.filter((r: Role) => r.is_system_role).length || 0}\n                </p>\n              </div>\n            </div>\n          </DashboardCard>\n\n          <DashboardCard>\n            <div className=\"flex items-center\">\n              <div className=\"p-3 bg-purple-500/10 rounded-lg\">\n                <Cog6ToothIcon className=\"h-6 w-6 text-purple-500\" />\n              </div>\n              <div className=\"ml-4\">\n                <p className=\"text-sm text-gray-400\">Custom Roles</p>\n                <p className=\"text-2xl font-bold text-white\">\n                  {roles?.filter((r: Role) => !r.is_system_role).length || 0}\n                </p>\n              </div>\n            </div>\n          </DashboardCard>\n\n          <DashboardCard>\n            <div className=\"flex items-center\">\n              <div className=\"p-3 bg-yellow-500/10 rounded-lg\">\n                <UsersIcon className=\"h-6 w-6 text-yellow-500\" />\n              </div>\n              <div className=\"ml-4\">\n                <p className=\"text-sm text-gray-400\">Total Users</p>\n                <p className=\"text-2xl font-bold text-white\">\n                  {roles?.reduce((sum: number, r: Role) => sum + r.user_count, 0) || 0}\n                </p>\n              </div>\n            </div>\n          </DashboardCard>\n        </div>\n\n        {/* Roles Table */}\n        <DashboardCard>\n          <div className=\"p-6\">\n            <div className=\"flex justify-between items-center mb-6\">\n              <h2 className=\"text-xl font-semibold text-white\">Roles</h2>\n              <div className=\"flex space-x-2\">\n                <StatusIndicator status=\"success\" label=\"Active\" />\n                <StatusIndicator status=\"warning\" label=\"System\" />\n                <StatusIndicator status=\"info\" label=\"Custom\" />\n              </div>\n            </div>\n\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full\">\n                <thead>\n                  <tr className=\"border-b border-gray-700\">\n                    <th className=\"text-left py-3 px-4 text-gray-400 font-medium\">Role</th>\n                    <th className=\"text-left py-3 px-4 text-gray-400 font-medium\">Type</th>\n                    <th className=\"text-left py-3 px-4 text-gray-400 font-medium\">Priority</th>\n                    <th className=\"text-left py-3 px-4 text-gray-400 font-medium\">Users</th>\n                    <th className=\"text-left py-3 px-4 text-gray-400 font-medium\">Permissions</th>\n                    <th className=\"text-left py-3 px-4 text-gray-400 font-medium\">Actions</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {roles?.map((role: Role) => (\n                    <tr key={role.id} className=\"border-b border-gray-700/50 hover:bg-gray-800/50\">\n                      <td className=\"py-4 px-4\">\n                        <div>\n                          <div className=\"text-white font-medium\">{role.display_name}</div>\n                          <div className=\"text-gray-400 text-sm\">{role.name}</div>\n                          <div className=\"text-gray-500 text-xs mt-1\">{role.description}</div>\n                        </div>\n                      </td>\n                      <td className=\"py-4 px-4\">\n                        <StatusIndicator\n                          status={role.is_system_role ? \"warning\" : \"info\"}\n                          label={role.is_system_role ? \"System\" : \"Custom\"}\n                        />\n                      </td>\n                      <td className=\"py-4 px-4\">\n                        <span className={`font-medium ${getRolePriorityColor(role.priority)}`}>\n                          {role.priority}\n                        </span>\n                      </td>\n                      <td className=\"py-4 px-4\">\n                        <div className=\"flex items-center\">\n                          <UsersIcon className=\"h-4 w-4 text-gray-400 mr-2\" />\n                          <span className=\"text-white\">{role.user_count}</span>\n                        </div>\n                      </td>\n                      <td className=\"py-4 px-4\">\n                        <div className=\"flex items-center\">\n                          <ShieldCheckIcon className=\"h-4 w-4 text-gray-400 mr-2\" />\n                          <span className=\"text-white\">{role.permissions.length}</span>\n                        </div>\n                      </td>\n                      <td className=\"py-4 px-4\">\n                        <div className=\"flex space-x-2\">\n                          <Button\n                            onClick={() => {\n                              setSelectedRole(role);\n                              setShowPermissionsModal(true);\n                            }}\n                            variant=\"ghost\"\n                            size=\"sm\"\n                          >\n                            <EyeIcon className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            onClick={() => {\n                              setSelectedRole(role);\n                              setShowEditModal(true);\n                            }}\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            disabled={role.is_system_role}\n                          >\n                            <PencilIcon className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            onClick={() => {\n                              setSelectedRole(role);\n                              setShowDeleteModal(true);\n                            }}\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            disabled={role.is_system_role || role.user_count > 0}\n                          >\n                            <TrashIcon className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </DashboardCard>\n\n        {/* Modals */}\n        <CreateRoleModal\n          isOpen={showCreateModal}\n          onClose={() => setShowCreateModal(false)}\n          onSubmit={(data) => createRoleMutation.mutate(data)}\n          isLoading={createRoleMutation.isPending}\n          permissions={permissions || []}\n        />\n\n        <EditRoleModal\n          isOpen={showEditModal}\n          onClose={() => setShowEditModal(false)}\n          onSubmit={(data) => selectedRole && updateRoleMutation.mutate({ id: selectedRole.id, data })}\n          isLoading={updateRoleMutation.isPending}\n          role={selectedRole}\n          permissions={permissions || []}\n        />\n\n        <DeleteRoleModal\n          isOpen={showDeleteModal}\n          onClose={() => setShowDeleteModal(false)}\n          onConfirm={() => selectedRole && deleteRoleMutation.mutate(selectedRole.id)}\n          isLoading={deleteRoleMutation.isPending}\n          role={selectedRole}\n        />\n\n        <PermissionsModal\n          isOpen={showPermissionsModal}\n          onClose={() => setShowPermissionsModal(false)}\n          onSubmit={(permissionIds) => \n            selectedRole && assignPermissionsMutation.mutate({ \n              roleId: selectedRole.id, \n              permissionIds \n            })\n          }\n          isLoading={assignPermissionsMutation.isPending}\n          role={selectedRole}\n          permissions={permissions || []}\n          categories={permissionCategories || {}}\n        />\n\n        {/* Toast */}\n        {toast.show && (\n          <Toast\n            message={toast.message}\n            type={toast.type}\n            onClose={() => setToast(prev => ({ ...prev, show: false }))}\n          />\n        )}\n      </div>\n    </div>\n  );\n}\n\n// Modal Components\nfunction CreateRoleModal({ isOpen, onClose, onSubmit, isLoading, permissions }: {\n  isOpen: boolean;\n  onClose: () => void;\n  onSubmit: (data: RoleFormData) => void;\n  isLoading: boolean;\n  permissions: Permission[];\n}) {\n  const [formData, setFormData] = useState<RoleFormData>({\n    name: '',\n    display_name: '',\n    description: '',\n    priority: 50,\n    permission_ids: [],\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    onSubmit(formData);\n  };\n\n  const handlePermissionChange = (permissionId: string, checked: boolean) => {\n    setFormData(prev => ({\n      ...prev,\n      permission_ids: checked\n        ? [...prev.permission_ids, permissionId]\n        : prev.permission_ids.filter(id => id !== permissionId)\n    }));\n  };\n\n  return (\n    <Modal isOpen={isOpen} onClose={onClose} title=\"Create New Role\">\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <TextField\n            label=\"Role Name\"\n            value={formData.name}\n            onChange={(value) => setFormData(prev => ({ ...prev, name: value }))}\n            placeholder=\"admin, manager, viewer\"\n            required\n          />\n          <TextField\n            label=\"Display Name\"\n            value={formData.display_name}\n            onChange={(value) => setFormData(prev => ({ ...prev, display_name: value }))}\n            placeholder=\"Administrator, Manager, Viewer\"\n            required\n          />\n        </div>\n\n        <TextField\n          label=\"Description\"\n          value={formData.description}\n          onChange={(value) => setFormData(prev => ({ ...prev, description: value }))}\n          placeholder=\"Describe the role's purpose and responsibilities\"\n          required\n        />\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n            Priority Level\n          </label>\n          <input\n            type=\"range\"\n            min=\"1\"\n            max=\"100\"\n            value={formData.priority}\n            onChange={(e) => setFormData(prev => ({ ...prev, priority: parseInt(e.target.value) }))}\n            className=\"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer\"\n          />\n          <div className=\"flex justify-between text-xs text-gray-400 mt-1\">\n            <span>Low (1)</span>\n            <span>Current: {formData.priority}</span>\n            <span>High (100)</span>\n          </div>\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-300 mb-4\">\n            Permissions\n          </label>\n          <div className=\"max-h-48 overflow-y-auto space-y-2\">\n            {permissions.map((permission) => (\n              <Checkbox\n                key={permission.id}\n                label={permission.display_name}\n                checked={formData.permission_ids.includes(permission.id)}\n                onChange={(checked) => handlePermissionChange(permission.id, checked)}\n              />\n            ))}\n          </div>\n        </div>\n\n        <div className=\"flex justify-end space-x-3\">\n          <Button\n            type=\"button\"\n            variant=\"secondary\"\n            onClick={onClose}\n            disabled={isLoading}\n          >\n            Cancel\n          </Button>\n          <Button\n            type=\"submit\"\n            variant=\"primary\"\n            isLoading={isLoading}\n          >\n            Create Role\n          </Button>\n        </div>\n      </form>\n    </Modal>\n  );\n}\n\nfunction EditRoleModal({ isOpen, onClose, onSubmit, isLoading, role, permissions }: {\n  isOpen: boolean;\n  onClose: () => void;\n  onSubmit: (data: Partial<RoleFormData>) => void;\n  isLoading: boolean;\n  role: Role | null;\n  permissions: Permission[];\n}) {\n  const [formData, setFormData] = useState<Partial<RoleFormData>>({});\n\n  useEffect(() => {\n    if (role) {\n      setFormData({\n        name: role.name,\n        display_name: role.display_name,\n        description: role.description,\n        priority: role.priority,\n        permission_ids: role.permissions.map(p => p.id),\n      });\n    }\n  }, [role]);\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    onSubmit(formData);\n  };\n\n  const handlePermissionChange = (permissionId: string, checked: boolean) => {\n    setFormData(prev => ({\n      ...prev,\n      permission_ids: checked\n        ? [...(prev.permission_ids || []), permissionId]\n        : (prev.permission_ids || []).filter(id => id !== permissionId)\n    }));\n  };\n\n  if (!role) return null;\n\n  return (\n    <Modal isOpen={isOpen} onClose={onClose} title=\"Edit Role\">\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <TextField\n            label=\"Role Name\"\n            value={formData.name || ''}\n            onChange={(value) => setFormData(prev => ({ ...prev, name: value }))}\n            placeholder=\"admin, manager, viewer\"\n            required\n          />\n          <TextField\n            label=\"Display Name\"\n            value={formData.display_name || ''}\n            onChange={(value) => setFormData(prev => ({ ...prev, display_name: value }))}\n            placeholder=\"Administrator, Manager, Viewer\"\n            required\n          />\n        </div>\n\n        <TextField\n          label=\"Description\"\n          value={formData.description || ''}\n          onChange={(value) => setFormData(prev => ({ ...prev, description: value }))}\n          placeholder=\"Describe the role's purpose and responsibilities\"\n          required\n        />\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n            Priority Level\n          </label>\n          <input\n            type=\"range\"\n            min=\"1\"\n            max=\"100\"\n            value={formData.priority || 50}\n            onChange={(e) => setFormData(prev => ({ ...prev, priority: parseInt(e.target.value) }))}\n            className=\"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer\"\n          />\n          <div className=\"flex justify-between text-xs text-gray-400 mt-1\">\n            <span>Low (1)</span>\n            <span>Current: {formData.priority}</span>\n            <span>High (100)</span>\n          </div>\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-300 mb-4\">\n            Permissions\n          </label>\n          <div className=\"max-h-48 overflow-y-auto space-y-2\">\n            {permissions.map((permission) => (\n              <Checkbox\n                key={permission.id}\n                label={permission.display_name}\n                checked={(formData.permission_ids || []).includes(permission.id)}\n                onChange={(checked) => handlePermissionChange(permission.id, checked)}\n              />\n            ))}\n          </div>\n        </div>\n\n        <div className=\"flex justify-end space-x-3\">\n          <Button\n            type=\"button\"\n            variant=\"secondary\"\n            onClick={onClose}\n            disabled={isLoading}\n          >\n            Cancel\n          </Button>\n          <Button\n            type=\"submit\"\n            variant=\"primary\"\n            isLoading={isLoading}\n          >\n            Update Role\n          </Button>\n        </div>\n      </form>\n    </Modal>\n  );\n}\n\nfunction DeleteRoleModal({ isOpen, onClose, onConfirm, isLoading, role }: {\n  isOpen: boolean;\n  onClose: () => void;\n  onConfirm: () => void;\n  isLoading: boolean;\n  role: Role | null;\n}) {\n  if (!role) return null;\n\n  return (\n    <Modal isOpen={isOpen} onClose={onClose} title=\"Delete Role\">\n      <div className=\"space-y-4\">\n        <div className=\"flex items-center p-4 bg-red-500/10 rounded-lg\">\n          <ExclamationTriangleIcon className=\"h-6 w-6 text-red-500 mr-3\" />\n          <div>\n            <h3 className=\"text-red-500 font-medium\">Confirm Deletion</h3>\n            <p className=\"text-red-400 text-sm\">This action cannot be undone.</p>\n          </div>\n        </div>\n\n        <div className=\"text-gray-300\">\n          <p>Are you sure you want to delete the role:</p>\n          <p className=\"font-medium text-white mt-2\">{role.display_name}</p>\n          <p className=\"text-gray-400 text-sm mt-1\">{role.description}</p>\n        </div>\n\n        <div className=\"flex justify-end space-x-3\">\n          <Button\n            type=\"button\"\n            variant=\"secondary\"\n            onClick={onClose}\n            disabled={isLoading}\n          >\n            Cancel\n          </Button>\n          <Button\n            type=\"button\"\n            variant=\"danger\"\n            onClick={onConfirm}\n            isLoading={isLoading}\n          >\n            Delete Role\n          </Button>\n        </div>\n      </div>\n    </Modal>\n  );\n}\n\nfunction PermissionsModal({ isOpen, onClose, onSubmit, isLoading, role, permissions, categories }: {\n  isOpen: boolean;\n  onClose: () => void;\n  onSubmit: (permissionIds: string[]) => void;\n  isLoading: boolean;\n  role: Role | null;\n  permissions: Permission[];\n  categories: Record<string, Permission[]>;\n}) {\n  const [selectedPermissions, setSelectedPermissions] = useState<string[]>([]);\n\n  useEffect(() => {\n    if (role) {\n      setSelectedPermissions(role.permissions.map(p => p.id));\n    }\n  }, [role]);\n\n  const handlePermissionChange = (permissionId: string, checked: boolean) => {\n    setSelectedPermissions(prev =>\n      checked\n        ? [...prev, permissionId]\n        : prev.filter(id => id !== permissionId)\n    );\n  };\n\n  const handleSubmit = () => {\n    onSubmit(selectedPermissions);\n  };\n\n  if (!role) return null;\n\n  return (\n    <Modal isOpen={isOpen} onClose={onClose} title={`Permissions for ${role.display_name}`}>\n      <div className=\"space-y-6\">\n        <div className=\"text-gray-300\">\n          <p>Select permissions for the <strong>{role.display_name}</strong> role:</p>\n        </div>\n\n        <div className=\"max-h-96 overflow-y-auto space-y-4\">\n          {Object.entries(categories).map(([categoryName, categoryPermissions]) => (\n            <div key={categoryName} className=\"border border-gray-700 rounded-lg p-4\">\n              <h4 className=\"text-white font-medium mb-3 capitalize\">{categoryName}</h4>\n              <div className=\"space-y-2\">\n                {categoryPermissions.map((permission) => (\n                  <Checkbox\n                    key={permission.id}\n                    label={\n                      <div>\n                        <span className=\"text-white\">{permission.display_name}</span>\n                        <span className=\"text-gray-400 text-sm block\">{permission.description}</span>\n                      </div>\n                    }\n                    checked={selectedPermissions.includes(permission.id)}\n                    onChange={(checked) => handlePermissionChange(permission.id, checked)}\n                  />\n                ))}\n              </div>\n            </div>\n          ))}\n        </div>\n\n        <div className=\"flex justify-end space-x-3\">\n          <Button\n            type=\"button\"\n            variant=\"secondary\"\n            onClick={onClose}\n            disabled={isLoading}\n          >\n            Cancel\n          </Button>\n          <Button\n            type=\"button\"\n            variant=\"primary\"\n            onClick={handleSubmit}\n            isLoading={isLoading}\n          >\n            Update Permissions\n          </Button>\n        </div>\n      </div>\n    </Modal>\n  );\n}\n\n// Export with admin access protection\nexport default withAdminAccess(RoleManagementPage);"],"names":["RoleManagementPage","queryClient","useQueryClient","adminPerms","useAdminPermissions","selectedRole","setSelectedRole","useState","canManageRoles","div","className","h2","p","showCreateModal","setShowCreateModal","showEditModal","setShowEditModal","showDeleteModal","setShowDeleteModal","showPermissionsModal","setShowPermissionsModal","toast","setToast","message","type","show","data","roles","isLoading","rolesLoading","error","rolesError","useQuery","queryKey","queryFn","response","fetch","headers","localStorage","getItem","ok","Error","json","permissions","permissionsLoading","permissionCategories","createRoleMutation","useMutation","mutationFn","roleData","method","body","JSON","stringify","onSuccess","invalidateQueries","showToast","onError","updateRoleMutation","id","deleteRoleMutation","assignPermissionsMutation","roleId","permissionIds","permission_ids","setTimeout","prev","getRolePriorityColor","priority","getRoleStatusColor","isSystemRole","map","i","XCircleIcon","h1","Button","onClick","window","location","reload","variant","UserGroupIcon","leftIcon","PlusIcon","DashboardCard","length","ShieldCheckIcon","filter","r","is_system_role","Cog6ToothIcon","UsersIcon","reduce","sum","user_count","StatusIndicator","status","label","table","thead","tr","th","tbody","role","td","display_name","name","description","span","size","EyeIcon","disabled","PencilIcon","TrashIcon","CreateRoleModal","isOpen","onClose","onSubmit","mutate","isPending","EditRoleModal","DeleteRoleModal","onConfirm","PermissionsModal","categories","Toast","formData","setFormData","handleSubmit","e","preventDefault","handlePermissionChange","permissionId","checked","Modal","title","form","TextField","value","onChange","placeholder","required","input","min","max","parseInt","target","permission","Checkbox","includes","useEffect","ExclamationTriangleIcon","h3","selectedPermissions","setSelectedPermissions","strong","Object","entries","categoryName","categoryPermissions","h4","withAdminAccess"],"mappings":"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"}