{"version":3,"sources":["/Users/pavan/Desktop/Devops-app-dev-cursor/frontend/src/contexts/TeamContext.tsx"],"sourcesContent":["/**\n * Team Context for managing the currently selected team across the dashboard.\n * Provides team selection, switching, and team-specific data filtering.\n */\n'use client';\n\nimport React, { createContext, useContext, useReducer, useEffect, ReactNode } from 'react';\nimport { Team, TeamMember } from '@/types/team';\nimport { teamApi } from '@/services/teamApi';\n\n// Team context state interface\ninterface TeamState {\n  currentTeam: Team | null;\n  userTeams: Team[];\n  userRole: string | null;\n  isLoading: boolean;\n  error: string | null;\n  hasMultipleTeams: boolean;\n}\n\n// Team action types\ntype TeamAction =\n  | { type: 'TEAMS_LOADING' }\n  | { type: 'TEAMS_LOADED'; payload: { teams: Team[]; currentTeam?: Team } }\n  | { type: 'TEAMS_ERROR'; payload: string }\n  | { type: 'TEAM_SELECTED'; payload: { team: Team; role: string } }\n  | { type: 'TEAM_CLEARED' };\n\n// Team context interface\ninterface TeamContextType {\n  state: TeamState;\n  selectTeam: (teamId: number) => Promise<void>;\n  refreshTeams: () => Promise<void>;\n  clearTeam: () => void;\n  isTeamMember: (teamId: number) => boolean;\n  getUserRoleInTeam: (teamId: number) => string | null;\n}\n\n// Initial state\nconst initialState: TeamState = {\n  currentTeam: null,\n  userTeams: [],\n  userRole: null,\n  isLoading: false,\n  error: null,\n  hasMultipleTeams: false,\n};\n\n// Team reducer\nfunction teamReducer(state: TeamState, action: TeamAction): TeamState {\n  switch (action.type) {\n    case 'TEAMS_LOADING':\n      return {\n        ...state,\n        isLoading: true,\n        error: null,\n      };\n    case 'TEAMS_LOADED':\n      return {\n        ...state,\n        isLoading: false,\n        userTeams: action.payload.teams,\n        currentTeam: action.payload.currentTeam || action.payload.teams[0] || null,\n        hasMultipleTeams: action.payload.teams.length > 1,\n        error: null,\n      };\n    case 'TEAMS_ERROR':\n      return {\n        ...state,\n        isLoading: false,\n        error: action.payload,\n      };\n    case 'TEAM_SELECTED':\n      return {\n        ...state,\n        currentTeam: action.payload.team,\n        userRole: action.payload.role,\n      };\n    case 'TEAM_CLEARED':\n      return {\n        ...state,\n        currentTeam: null,\n        userRole: null,\n      };\n    default:\n      return state;\n  }\n}\n\n// Create context\nconst TeamContext = createContext<TeamContextType | undefined>(undefined);\n\n// Storage keys\nconst STORAGE_KEYS = {\n  SELECTED_TEAM_ID: 'opsight_selected_team_id',\n} as const;\n\n/**\n * Team Provider Component\n * \n * Manages team selection state and provides team context to child components.\n * Handles team loading, selection persistence, and role management.\n * \n * @param children - Child components that need access to team context\n */\nexport const TeamProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\n  const [state, dispatch] = useReducer(teamReducer, initialState);\n\n  /**\n   * Load user's teams from the API\n   */\n  const loadUserTeams = async (): Promise<void> => {\n    try {\n      dispatch({ type: 'TEAMS_LOADING' });\n      \n      // Get user's teams\n      const response = await teamApi.getUserTeams();\n      const teams = response || [];\n      \n      // Try to restore previously selected team\n      const savedTeamId = localStorage.getItem(STORAGE_KEYS.SELECTED_TEAM_ID);\n      let currentTeam: Team | undefined;\n      \n      if (savedTeamId) {\n        currentTeam = teams.find(team => team.id === parseInt(savedTeamId));\n      }\n      \n      // If no saved team or saved team not found, select first team\n      if (!currentTeam && teams.length > 0) {\n        currentTeam = teams[0];\n      }\n      \n      dispatch({\n        type: 'TEAMS_LOADED',\n        payload: { teams, currentTeam },\n      });\n      \n      // If we have a current team, get user's role\n      if (currentTeam) {\n        await setUserRoleForTeam(currentTeam.id);\n      }\n      \n    } catch (error) {\n      console.error('Failed to load user teams:', error);\n      dispatch({\n        type: 'TEAMS_ERROR',\n        payload: error instanceof Error ? error.message : 'Failed to load teams',\n      });\n    }\n  };\n\n  /**\n   * Get user's role in a specific team\n   */\n  const setUserRoleForTeam = async (teamId: number): Promise<void> => {\n    try {\n      const members = await teamApi.getTeamMembers(teamId);\n      const currentUser = members.find((member: any) => member.user_id === state.currentTeam?.created_by_user_id);\n      const userRole = currentUser?.role || 'VIEWER';\n      \n      if (state.currentTeam?.id === teamId) {\n        dispatch({\n          type: 'TEAM_SELECTED',\n          payload: {\n            team: state.currentTeam,\n            role: userRole,\n          },\n        });\n      }\n    } catch (error) {\n      console.error('Failed to get user role for team:', error);\n    }\n  };\n\n  /**\n   * Select a specific team\n   */\n  const selectTeam = async (teamId: number): Promise<void> => {\n    const team = state.userTeams.find(t => t.id === teamId);\n    if (!team) {\n      throw new Error('Team not found in user teams');\n    }\n\n    try {\n      // Get user's role in the selected team\n      const members = await teamApi.getTeamMembers(teamId);\n      const currentUser = members.find((member: any) => member.user_id === team.created_by_user_id);\n      const userRole = currentUser?.role || 'VIEWER';\n      \n      dispatch({\n        type: 'TEAM_SELECTED',\n        payload: {\n          team,\n          role: userRole,\n        },\n      });\n\n      // Persist selection\n      localStorage.setItem(STORAGE_KEYS.SELECTED_TEAM_ID, teamId.toString());\n      \n    } catch (error) {\n      console.error('Failed to select team:', error);\n      throw error;\n    }\n  };\n\n  /**\n   * Refresh teams data\n   */\n  const refreshTeams = async (): Promise<void> => {\n    await loadUserTeams();\n  };\n\n  /**\n   * Clear current team selection\n   */\n  const clearTeam = (): void => {\n    dispatch({ type: 'TEAM_CLEARED' });\n    localStorage.removeItem(STORAGE_KEYS.SELECTED_TEAM_ID);\n  };\n\n  /**\n   * Check if user is a member of a specific team\n   */\n  const isTeamMember = (teamId: number): boolean => {\n    return state.userTeams.some(team => team.id === teamId);\n  };\n\n  /**\n   * Get user's role in a specific team\n   */\n  const getUserRoleInTeam = (teamId: number): string | null => {\n    if (state.currentTeam?.id === teamId) {\n      return state.userRole;\n    }\n    // For other teams, we'd need to make an API call or cache roles\n    return null;\n  };\n\n  /**\n   * Load teams on component mount\n   */\n  useEffect(() => {\n    loadUserTeams();\n  }, []);\n\n  const contextValue: TeamContextType = {\n    state,\n    selectTeam,\n    refreshTeams,\n    clearTeam,\n    isTeamMember,\n    getUserRoleInTeam,\n  };\n\n  return (\n    <TeamContext.Provider value={contextValue}>\n      {children}\n    </TeamContext.Provider>\n  );\n};\n\n/**\n * Hook to use team context\n * \n * @returns Team context with state and actions\n * @throws Error if used outside TeamProvider\n */\nexport const useTeam = (): TeamContextType => {\n  const context = useContext(TeamContext);\n  if (context === undefined) {\n    throw new Error('useTeam must be used within a TeamProvider');\n  }\n  return context;\n};\n\nexport default TeamProvider; "],"names":["TeamProvider","useTeam","initialState","currentTeam","userTeams","userRole","isLoading","error","hasMultipleTeams","teamReducer","state","action","type","payload","teams","length","team","role","TeamContext","createContext","undefined","STORAGE_KEYS","SELECTED_TEAM_ID","children","dispatch","useReducer","loadUserTeams","response","teamApi","getUserTeams","savedTeamId","localStorage","getItem","find","id","parseInt","setUserRoleForTeam","console","Error","message","teamId","members","getTeamMembers","currentUser","member","user_id","created_by_user_id","selectTeam","t","setItem","toString","refreshTeams","clearTeam","removeItem","isTeamMember","some","getUserRoleInTeam","useEffect","contextValue","Provider","value","context","useContext"],"mappings":"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"}