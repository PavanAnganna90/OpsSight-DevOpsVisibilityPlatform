{"version":3,"sources":["/Users/pavan/Desktop/Devops-app-dev-cursor/frontend/src/components/notifications/SlackIntegration.tsx"],"sourcesContent":["/**\n * Slack Integration Component\n * \n * Provides Slack workspace integration for notifications and alerts.\n * Allows users to connect their Slack workspace and configure notification preferences.\n */\n\n'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/Card';\nimport { Button } from '@/components/ui/Button';\nimport { Badge } from '@/components/ui/Badge';\nimport { Modal } from '@/components/ui/Modal';\nimport { useToast } from '@/components/ui/Toast';\nimport { usePerformanceMonitoring } from '@/hooks/useMonitoring';\n\ninterface SlackWorkspace {\n  id: string;\n  name: string;\n  domain: string;\n  icon: string;\n  connected: boolean;\n  connectedAt?: string;\n  channels: SlackChannel[];\n}\n\ninterface SlackChannel {\n  id: string;\n  name: string;\n  isPrivate: boolean;\n  memberCount: number;\n  purpose?: string;\n}\n\ninterface SlackNotificationConfig {\n  enabled: boolean;\n  workspaceId: string;\n  channelId: string;\n  alertTypes: string[];\n  threshold: 'low' | 'medium' | 'high' | 'critical';\n  mentionUsers: string[];\n  customMessage?: string;\n}\n\nconst SlackIntegration: React.FC = () => {\n  const { trackUserInteraction } = usePerformanceMonitoring('SlackIntegration');\n  const { showToast } = useToast();\n  \n  const [workspaces, setWorkspaces] = useState<SlackWorkspace[]>([]);\n  const [selectedWorkspace, setSelectedWorkspace] = useState<SlackWorkspace | null>(null);\n  const [notificationConfigs, setNotificationConfigs] = useState<SlackNotificationConfig[]>([]);\n  const [showConnectModal, setShowConnectModal] = useState(false);\n  const [showConfigModal, setShowConfigModal] = useState(false);\n  const [selectedConfig, setSelectedConfig] = useState<SlackNotificationConfig | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [isConnecting, setIsConnecting] = useState(false);\n\n  // Load Slack workspaces and configurations\n  useEffect(() => {\n    const loadSlackData = async () => {\n      setIsLoading(true);\n      \n      try {\n        // In a real app, these would be API calls\n        const mockWorkspaces: SlackWorkspace[] = [\n          {\n            id: 'workspace_1',\n            name: 'DevOps Team',\n            domain: 'devops-team.slack.com',\n            icon: 'ðŸš€',\n            connected: true,\n            connectedAt: '2023-01-01T00:00:00Z',\n            channels: [\n              {\n                id: 'channel_1',\n                name: 'alerts',\n                isPrivate: false,\n                memberCount: 25,\n                purpose: 'System alerts and notifications'\n              },\n              {\n                id: 'channel_2',\n                name: 'devops',\n                isPrivate: false,\n                memberCount: 15,\n                purpose: 'DevOps discussions and updates'\n              },\n              {\n                id: 'channel_3',\n                name: 'critical-alerts',\n                isPrivate: true,\n                memberCount: 8,\n                purpose: 'Critical system alerts'\n              }\n            ]\n          },\n          {\n            id: 'workspace_2',\n            name: 'Engineering',\n            domain: 'engineering.slack.com',\n            icon: 'âš™ï¸',\n            connected: false,\n            channels: []\n          }\n        ];\n\n        const mockConfigs: SlackNotificationConfig[] = [\n          {\n            enabled: true,\n            workspaceId: 'workspace_1',\n            channelId: 'channel_1',\n            alertTypes: ['error', 'warning', 'info'],\n            threshold: 'medium',\n            mentionUsers: ['@channel'],\n            customMessage: 'OpsSight Alert: {alert_type} - {message}'\n          },\n          {\n            enabled: true,\n            workspaceId: 'workspace_1',\n            channelId: 'channel_3',\n            alertTypes: ['critical'],\n            threshold: 'critical',\n            mentionUsers: ['@here', '@john.doe'],\n            customMessage: 'ðŸš¨ CRITICAL ALERT: {message}'\n          }\n        ];\n\n        setWorkspaces(mockWorkspaces);\n        setNotificationConfigs(mockConfigs);\n        \n        trackUserInteraction('view_slack_integration');\n        \n      } catch (error) {\n        console.error('Failed to load Slack data:', error);\n        showToast('Failed to load Slack integration data', 'error');\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    loadSlackData();\n  }, [trackUserInteraction, showToast]);\n\n  // Connect to Slack workspace\n  const handleConnectSlack = async () => {\n    setIsConnecting(true);\n    \n    try {\n      // In a real app, this would initiate OAuth flow\n      const authUrl = `https://slack.com/oauth/v2/authorize?client_id=your_client_id&scope=chat:write,channels:read&redirect_uri=${encodeURIComponent(window.location.origin + '/auth/slack/callback')}`;\n      \n      // Open Slack OAuth in new window\n      const authWindow = window.open(\n        authUrl,\n        'slack-auth',\n        'width=600,height=700,scrollbars=yes,resizable=yes'\n      );\n\n      // Listen for OAuth completion\n      const handleMessage = (event: MessageEvent) => {\n        if (event.origin !== window.location.origin) return;\n        \n        if (event.data.type === 'SLACK_AUTH_SUCCESS') {\n          authWindow?.close();\n          \n          // Mock successful connection\n          const newWorkspace: SlackWorkspace = {\n            id: 'workspace_3',\n            name: event.data.team_name || 'New Workspace',\n            domain: event.data.team_domain || 'new-workspace.slack.com',\n            icon: 'âœ…',\n            connected: true,\n            connectedAt: new Date().toISOString(),\n            channels: event.data.channels || []\n          };\n          \n          setWorkspaces(prev => [...prev, newWorkspace]);\n          setShowConnectModal(false);\n          showToast('Successfully connected to Slack workspace', 'success');\n          \n          trackUserInteraction('connect_slack_workspace', {\n            workspaceId: newWorkspace.id,\n            workspaceName: newWorkspace.name\n          });\n        }\n      };\n\n      window.addEventListener('message', handleMessage);\n      \n      // Cleanup\n      const checkClosed = setInterval(() => {\n        if (authWindow?.closed) {\n          clearInterval(checkClosed);\n          window.removeEventListener('message', handleMessage);\n          setIsConnecting(false);\n        }\n      }, 1000);\n      \n    } catch (error) {\n      console.error('Failed to connect to Slack:', error);\n      showToast('Failed to connect to Slack workspace', 'error');\n      setIsConnecting(false);\n    }\n  };\n\n  // Disconnect from Slack workspace\n  const handleDisconnectSlack = async (workspaceId: string) => {\n    try {\n      // In a real app, this would revoke OAuth token\n      setWorkspaces(prev => prev.map(workspace => \n        workspace.id === workspaceId \n          ? { ...workspace, connected: false, channels: [] }\n          : workspace\n      ));\n      \n      // Remove associated notification configurations\n      setNotificationConfigs(prev => \n        prev.filter(config => config.workspaceId !== workspaceId)\n      );\n      \n      showToast('Successfully disconnected from Slack workspace', 'success');\n      \n      trackUserInteraction('disconnect_slack_workspace', {\n        workspaceId\n      });\n      \n    } catch (error) {\n      console.error('Failed to disconnect from Slack:', error);\n      showToast('Failed to disconnect from Slack workspace', 'error');\n    }\n  };\n\n  // Test Slack notification\n  const handleTestNotification = async (config: SlackNotificationConfig) => {\n    try {\n      const workspace = workspaces.find(w => w.id === config.workspaceId);\n      const channel = workspace?.channels.find(c => c.id === config.channelId);\n      \n      if (!workspace || !channel) {\n        throw new Error('Workspace or channel not found');\n      }\n      \n      // Mock sending test notification\n      await new Promise(resolve => setTimeout(resolve, 1000));\n      \n      showToast(`Test notification sent to #${channel.name}`, 'success');\n      \n      trackUserInteraction('test_slack_notification', {\n        workspaceId: config.workspaceId,\n        channelId: config.channelId\n      });\n      \n    } catch (error) {\n      console.error('Failed to send test notification:', error);\n      showToast('Failed to send test notification', 'error');\n    }\n  };\n\n  // Save notification configuration\n  const handleSaveConfig = async (config: SlackNotificationConfig) => {\n    try {\n      if (selectedConfig) {\n        // Update existing config\n        setNotificationConfigs(prev => \n          prev.map(c => \n            c.workspaceId === config.workspaceId && c.channelId === config.channelId\n              ? config\n              : c\n          )\n        );\n      } else {\n        // Add new config\n        setNotificationConfigs(prev => [...prev, config]);\n      }\n      \n      setShowConfigModal(false);\n      setSelectedConfig(null);\n      showToast('Notification configuration saved', 'success');\n      \n      trackUserInteraction('save_slack_config', {\n        workspaceId: config.workspaceId,\n        channelId: config.channelId,\n        alertTypes: config.alertTypes\n      });\n      \n    } catch (error) {\n      console.error('Failed to save configuration:', error);\n      showToast('Failed to save configuration', 'error');\n    }\n  };\n\n  // Get workspace by ID\n  const getWorkspaceById = (id: string) => {\n    return workspaces.find(w => w.id === id);\n  };\n\n  // Get channel by ID\n  const getChannelById = (workspaceId: string, channelId: string) => {\n    const workspace = getWorkspaceById(workspaceId);\n    return workspace?.channels.find(c => c.id === channelId);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n            Slack Integration\n          </h2>\n          <p className=\"text-gray-600 dark:text-gray-400\">\n            Connect your Slack workspaces to receive notifications and alerts\n          </p>\n        </div>\n        \n        <Button\n          onClick={() => setShowConnectModal(true)}\n          disabled={isConnecting}\n        >\n          {isConnecting ? 'Connecting...' : 'Connect Workspace'}\n        </Button>\n      </div>\n\n      {/* Connected Workspaces */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Connected Workspaces</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {workspaces.length === 0 ? (\n            <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n              No Slack workspaces connected\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {workspaces.map((workspace) => (\n                <div\n                  key={workspace.id}\n                  className=\"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg\"\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"text-2xl\">{workspace.icon}</div>\n                    <div>\n                      <h3 className=\"font-medium text-gray-900 dark:text-white\">\n                        {workspace.name}\n                      </h3>\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                        {workspace.domain}\n                      </p>\n                      {workspace.connected && workspace.connectedAt && (\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                          Connected {new Date(workspace.connectedAt).toLocaleDateString()}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex items-center gap-2\">\n                    <Badge \n                      variant={workspace.connected ? 'default' : 'secondary'}\n                    >\n                      {workspace.connected ? 'Connected' : 'Disconnected'}\n                    </Badge>\n                    \n                    {workspace.connected && (\n                      <>\n                        <Button\n                          onClick={() => {\n                            setSelectedWorkspace(workspace);\n                            setShowConfigModal(true);\n                          }}\n                          variant=\"outline\"\n                          size=\"sm\"\n                        >\n                          Configure\n                        </Button>\n                        <Button\n                          onClick={() => handleDisconnectSlack(workspace.id)}\n                          variant=\"outline\"\n                          size=\"sm\"\n                        >\n                          Disconnect\n                        </Button>\n                      </>\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Notification Configurations */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Notification Configurations</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {notificationConfigs.length === 0 ? (\n            <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\n              No notification configurations set up\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {notificationConfigs.map((config, index) => {\n                const workspace = getWorkspaceById(config.workspaceId);\n                const channel = getChannelById(config.workspaceId, config.channelId);\n                \n                return (\n                  <div\n                    key={index}\n                    className=\"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg\"\n                  >\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <h3 className=\"font-medium text-gray-900 dark:text-white\">\n                          {workspace?.name} â†’ #{channel?.name}\n                        </h3>\n                        <Badge \n                          variant={config.enabled ? 'default' : 'secondary'}\n                        >\n                          {config.enabled ? 'Enabled' : 'Disabled'}\n                        </Badge>\n                        <Badge variant=\"outline\">\n                          {config.threshold}\n                        </Badge>\n                      </div>\n                      \n                      <div className=\"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400\">\n                        <span>\n                          Alert Types: {config.alertTypes.join(', ')}\n                        </span>\n                        <span>\n                          Mentions: {config.mentionUsers.join(', ')}\n                        </span>\n                      </div>\n                      \n                      {config.customMessage && (\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n                          Custom Message: {config.customMessage}\n                        </p>\n                      )}\n                    </div>\n                    \n                    <div className=\"flex items-center gap-2\">\n                      <Button\n                        onClick={() => handleTestNotification(config)}\n                        variant=\"outline\"\n                        size=\"sm\"\n                      >\n                        Test\n                      </Button>\n                      <Button\n                        onClick={() => {\n                          setSelectedConfig(config);\n                          setSelectedWorkspace(workspace || null);\n                          setShowConfigModal(true);\n                        }}\n                        variant=\"outline\"\n                        size=\"sm\"\n                      >\n                        Edit\n                      </Button>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Connect Workspace Modal */}\n      {showConnectModal && (\n        <Modal\n          isOpen={showConnectModal}\n          onClose={() => setShowConnectModal(false)}\n          title=\"Connect Slack Workspace\"\n        >\n          <div className=\"space-y-4\">\n            <div className=\"text-center\">\n              <div className=\"text-6xl mb-4\">ðŸš€</div>\n              <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-2\">\n                Connect Your Slack Workspace\n              </h3>\n              <p className=\"text-gray-600 dark:text-gray-400\">\n                Authorize OpsSight to send notifications to your Slack workspace\n              </p>\n            </div>\n            \n            <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg\">\n              <h4 className=\"font-medium text-blue-900 dark:text-blue-100 mb-2\">\n                Required Permissions\n              </h4>\n              <ul className=\"text-sm text-blue-800 dark:text-blue-200 space-y-1\">\n                <li>â€¢ Send messages to channels</li>\n                <li>â€¢ Read channel information</li>\n                <li>â€¢ View workspace information</li>\n              </ul>\n            </div>\n            \n            <div className=\"flex gap-3\">\n              <Button\n                onClick={handleConnectSlack}\n                disabled={isConnecting}\n                className=\"flex-1\"\n              >\n                {isConnecting ? 'Connecting...' : 'Connect to Slack'}\n              </Button>\n              <Button\n                onClick={() => setShowConnectModal(false)}\n                variant=\"outline\"\n              >\n                Cancel\n              </Button>\n            </div>\n          </div>\n        </Modal>\n      )}\n\n      {/* Configuration Modal */}\n      {showConfigModal && selectedWorkspace && (\n        <SlackConfigModal\n          workspace={selectedWorkspace}\n          config={selectedConfig}\n          onSave={handleSaveConfig}\n          onClose={() => {\n            setShowConfigModal(false);\n            setSelectedConfig(null);\n            setSelectedWorkspace(null);\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\n// Slack Configuration Modal Component\ninterface SlackConfigModalProps {\n  workspace: SlackWorkspace;\n  config: SlackNotificationConfig | null;\n  onSave: (config: SlackNotificationConfig) => void;\n  onClose: () => void;\n}\n\nconst SlackConfigModal: React.FC<SlackConfigModalProps> = ({\n  workspace,\n  config,\n  onSave,\n  onClose\n}) => {\n  const [formData, setFormData] = useState<SlackNotificationConfig>({\n    enabled: config?.enabled ?? true,\n    workspaceId: workspace.id,\n    channelId: config?.channelId ?? '',\n    alertTypes: config?.alertTypes ?? ['error', 'warning'],\n    threshold: config?.threshold ?? 'medium',\n    mentionUsers: config?.mentionUsers ?? [],\n    customMessage: config?.customMessage ?? ''\n  });\n\n  const alertTypeOptions = [\n    { value: 'info', label: 'Info' },\n    { value: 'warning', label: 'Warning' },\n    { value: 'error', label: 'Error' },\n    { value: 'critical', label: 'Critical' }\n  ];\n\n  const thresholdOptions = [\n    { value: 'low', label: 'Low' },\n    { value: 'medium', label: 'Medium' },\n    { value: 'high', label: 'High' },\n    { value: 'critical', label: 'Critical' }\n  ];\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    onSave(formData);\n  };\n\n  return (\n    <Modal\n      isOpen={true}\n      onClose={onClose}\n      title={`Configure Notifications - ${workspace.name}`}\n    >\n      <form onSubmit={handleSubmit} className=\"space-y-4\">\n        {/* Channel Selection */}\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n            Channel\n          </label>\n          <select\n            value={formData.channelId}\n            onChange={(e) => setFormData(prev => ({ ...prev, channelId: e.target.value }))}\n            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-800\"\n            required\n          >\n            <option value=\"\">Select a channel</option>\n            {workspace.channels.map(channel => (\n              <option key={channel.id} value={channel.id}>\n                #{channel.name} {channel.isPrivate ? '(Private)' : ''}\n              </option>\n            ))}\n          </select>\n        </div>\n\n        {/* Alert Types */}\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n            Alert Types\n          </label>\n          <div className=\"grid grid-cols-2 gap-2\">\n            {alertTypeOptions.map(option => (\n              <label key={option.value} className=\"flex items-center\">\n                <input\n                  type=\"checkbox\"\n                  checked={formData.alertTypes.includes(option.value)}\n                  onChange={(e) => {\n                    const newAlertTypes = e.target.checked\n                      ? [...formData.alertTypes, option.value]\n                      : formData.alertTypes.filter(t => t !== option.value);\n                    setFormData(prev => ({ ...prev, alertTypes: newAlertTypes }));\n                  }}\n                  className=\"mr-2\"\n                />\n                <span className=\"text-sm\">{option.label}</span>\n              </label>\n            ))}\n          </div>\n        </div>\n\n        {/* Threshold */}\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n            Minimum Threshold\n          </label>\n          <select\n            value={formData.threshold}\n            onChange={(e) => setFormData(prev => ({ ...prev, threshold: e.target.value as any }))}\n            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-800\"\n          >\n            {thresholdOptions.map(option => (\n              <option key={option.value} value={option.value}>\n                {option.label}\n              </option>\n            ))}\n          </select>\n        </div>\n\n        {/* Custom Message */}\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n            Custom Message Template\n          </label>\n          <textarea\n            value={formData.customMessage}\n            onChange={(e) => setFormData(prev => ({ ...prev, customMessage: e.target.value }))}\n            placeholder=\"OpsSight Alert: {alert_type} - {message}\"\n            rows={3}\n            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-800\"\n          />\n          <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n            Available variables: {'{alert_type}'}, {'{message}'}, {'{timestamp}'}, {'{severity}'}\n          </p>\n        </div>\n\n        {/* Actions */}\n        <div className=\"flex gap-3\">\n          <Button type=\"submit\" className=\"flex-1\">\n            {config ? 'Update Configuration' : 'Create Configuration'}\n          </Button>\n          <Button type=\"button\" onClick={onClose} variant=\"outline\">\n            Cancel\n          </Button>\n        </div>\n      </form>\n    </Modal>\n  );\n};\n\nexport default SlackIntegration;"],"names":["SlackIntegration","trackUserInteraction","usePerformanceMonitoring","showToast","useToast","workspaces","setWorkspaces","useState","selectedWorkspace","setSelectedWorkspace","notificationConfigs","setNotificationConfigs","showConnectModal","setShowConnectModal","showConfigModal","setShowConfigModal","selectedConfig","setSelectedConfig","isLoading","setIsLoading","isConnecting","setIsConnecting","useEffect","loadSlackData","mockWorkspaces","id","name","domain","icon","connected","connectedAt","channels","isPrivate","memberCount","purpose","mockConfigs","enabled","workspaceId","channelId","alertTypes","threshold","mentionUsers","customMessage","error","console","handleConnectSlack","authUrl","encodeURIComponent","window","location","origin","authWindow","open","handleMessage","event","data","type","close","newWorkspace","team_name","team_domain","Date","toISOString","prev","workspaceName","addEventListener","checkClosed","setInterval","closed","clearInterval","removeEventListener","handleDisconnectSlack","map","workspace","filter","config","handleTestNotification","find","w","channel","c","Error","Promise","resolve","setTimeout","handleSaveConfig","getWorkspaceById","getChannelById","div","className","h2","p","Button","onClick","disabled","Card","CardHeader","CardTitle","CardContent","length","h3","toLocaleDateString","Badge","variant","size","index","span","join","Modal","isOpen","onClose","title","h4","ul","li","SlackConfigModal","onSave","formData","setFormData","alertTypeOptions","value","label","thresholdOptions","handleSubmit","e","preventDefault","form","onSubmit","select","onChange","target","required","option","input","checked","includes","newAlertTypes","t","textarea","placeholder","rows"],"mappings":"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"}