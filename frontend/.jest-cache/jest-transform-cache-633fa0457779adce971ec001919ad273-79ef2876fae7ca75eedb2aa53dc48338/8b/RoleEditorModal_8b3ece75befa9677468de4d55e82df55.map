{"version":3,"sources":["/Users/pavan/Desktop/Devops-app-dev-cursor/frontend/src/components/admin/role-management/RoleEditorModal.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { Role, Permission, SystemRole } from '../../../types/role';\nimport PermissionMatrix from './PermissionMatrix';\n\ninterface RoleEditorModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  role: Role | null;\n  onRoleUpdated?: () => void;\n}\n\n/**\n * Modal for creating or editing a role and assigning permissions.\n */\nconst RoleEditorModal: React.FC<RoleEditorModalProps> = ({ isOpen, onClose, role, onRoleUpdated }) => {\n  const [name, setName] = useState(role?.name || '');\n  const [description, setDescription] = useState(role?.description || '');\n  const [permissions, setPermissions] = useState<Permission[]>(role?.permissions || []);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  // Reset state when role changes\n  React.useEffect(() => {\n    setName(role?.name || '');\n    setDescription(role?.description || '');\n    setPermissions(role?.permissions || []);\n    setError(null);\n  }, [role]);\n\n  const handleSave = async () => {\n    if (!name.trim()) {\n      setError('Role name is required');\n      return;\n    }\n\n    setLoading(true);\n    setError(null);\n\n    try {\n      const payload = {\n        name,\n        description,\n        permission_ids: permissions.map(p => p.id),\n      };\n\n      let response;\n      if (role) {\n        // Update existing role\n        response = await fetch(`/api/v1/roles/${role.id}`, {\n          method: 'PUT',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(payload),\n        });\n      } else {\n        // Create new role\n        response = await fetch('/api/v1/roles', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            ...payload,\n            system_role: SystemRole.VIEWER, // Default system role for new roles\n          }),\n        });\n      }\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.detail || 'Failed to save role');\n      }\n\n      await response.json();\n      onRoleUpdated?.();\n      onClose();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'An error occurred');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40\">\n      <div className=\"bg-white dark:bg-gray-900 rounded-lg shadow-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto\" role=\"dialog\" aria-modal=\"true\">\n        <h3 className=\"text-lg font-bold mb-4\">{role ? 'Edit Role' : 'Create Role'}</h3>\n        \n        {error && (\n          <div className=\"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded\">\n            {error}\n          </div>\n        )}\n        \n        <div className=\"mb-4\">\n          <label htmlFor=\"role-name\" className=\"block mb-1 font-medium\">Role Name</label>\n          <input\n            id=\"role-name\"\n            className=\"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            value={name}\n            onChange={e => setName(e.target.value)}\n            disabled={loading}\n          />\n        </div>\n        \n        <div className=\"mb-4\">\n          <label htmlFor=\"role-description\" className=\"block mb-1 font-medium\">Description</label>\n          <textarea\n            id=\"role-description\"\n            className=\"w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            value={description}\n            onChange={e => setDescription(e.target.value)}\n            disabled={loading}\n            rows={3}\n          />\n        </div>\n        \n        <div className=\"mb-6\">\n          <label className=\"block mb-2 font-medium\">Permissions</label>\n          <div className=\"max-h-64 overflow-y-auto border rounded p-3\">\n            <PermissionMatrix permissions={permissions} setPermissions={setPermissions} />\n          </div>\n        </div>\n        \n        <div className=\"flex justify-end gap-2\">\n          <button \n            className=\"px-4 py-2 rounded bg-gray-200 hover:bg-gray-300 disabled:opacity-50\"\n            onClick={onClose}\n            disabled={loading}\n          >\n            Cancel\n          </button>\n          <button \n            className=\"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50\"\n            onClick={handleSave}\n            disabled={loading}\n          >\n            {loading ? 'Saving...' : 'Save'}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default RoleEditorModal;\n"],"names":["RoleEditorModal","isOpen","onClose","role","onRoleUpdated","name","setName","useState","description","setDescription","permissions","setPermissions","loading","setLoading","error","setError","React","useEffect","handleSave","trim","payload","permission_ids","map","p","id","response","fetch","method","headers","body","JSON","stringify","system_role","SystemRole","VIEWER","ok","errorData","json","Error","detail","err","message","div","className","aria-modal","h3","label","htmlFor","input","value","onChange","e","target","disabled","textarea","rows","PermissionMatrix","button","onClick"],"mappings":"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"}