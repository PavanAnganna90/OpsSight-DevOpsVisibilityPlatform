{"version":3,"sources":["/Users/pavan/Desktop/Devops-app-dev-cursor/frontend/src/hooks/useAutoRefresh.ts"],"sourcesContent":["/**\n * Auto Refresh Hook\n * \n * Custom hook for implementing auto-refresh functionality with\n * configurable intervals, pause/resume, and visibility detection.\n */\n\nimport { useEffect, useRef, useState, useCallback } from 'react';\n\ninterface UseAutoRefreshOptions {\n  /** Refresh interval in milliseconds */\n  interval?: number;\n  /** Whether auto-refresh is enabled by default */\n  enabled?: boolean;\n  /** Pause when tab is not visible */\n  pauseOnHidden?: boolean;\n  /** Pause when user is idle */\n  pauseOnIdle?: boolean;\n  /** Idle timeout in milliseconds */\n  idleTimeout?: number;\n}\n\ninterface UseAutoRefreshReturn {\n  /** Whether auto-refresh is currently enabled */\n  isEnabled: boolean;\n  /** Whether auto-refresh is currently paused */\n  isPaused: boolean;\n  /** Whether user is considered idle */\n  isIdle: boolean;\n  /** Time until next refresh (in seconds) */\n  timeUntilRefresh: number;\n  /** Enable auto-refresh */\n  enable: () => void;\n  /** Disable auto-refresh */\n  disable: () => void;\n  /** Toggle auto-refresh */\n  toggle: () => void;\n  /** Manually trigger refresh */\n  refresh: () => void;\n  /** Set refresh interval */\n  setInterval: (interval: number) => void;\n}\n\n/**\n * Auto Refresh Hook\n * \n * Provides auto-refresh functionality with smart pausing based on\n * tab visibility and user activity.\n * \n * Features:\n * - Configurable refresh intervals\n * - Automatic pause when tab is hidden\n * - Idle detection and pause\n * - Manual refresh triggering\n * - Countdown timer display\n * - Memory cleanup on unmount\n * \n * @param callback - Function to call on each refresh\n * @param options - Configuration options\n * @returns Auto-refresh control interface\n */\nexport const useAutoRefresh = (\n  callback: () => void | Promise<void>,\n  options: UseAutoRefreshOptions = {}\n): UseAutoRefreshReturn => {\n  const {\n    interval = 30000, // 30 seconds default\n    enabled = true,\n    pauseOnHidden = true,\n    pauseOnIdle = true,\n    idleTimeout = 300000, // 5 minutes default\n  } = options;\n\n  const [isEnabled, setIsEnabled] = useState(enabled);\n  const [isPaused, setIsPaused] = useState(false);\n  const [isIdle, setIsIdle] = useState(false);\n  const [timeUntilRefresh, setTimeUntilRefresh] = useState(Math.floor(interval / 1000));\n  const [currentInterval, setCurrentInterval] = useState(interval);\n\n  const intervalRef = useRef<NodeJS.Timeout | null>(null);\n  const countdownRef = useRef<NodeJS.Timeout | null>(null);\n  const idleTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const lastActivityRef = useRef<number>(Date.now());\n\n  /**\n   * Clear all timers\n   */\n  const clearTimers = useCallback(() => {\n    if (intervalRef.current) {\n      clearInterval(intervalRef.current);\n      intervalRef.current = null;\n    }\n    if (countdownRef.current) {\n      clearInterval(countdownRef.current);\n      countdownRef.current = null;\n    }\n    if (idleTimeoutRef.current) {\n      clearTimeout(idleTimeoutRef.current);\n      idleTimeoutRef.current = null;\n    }\n  }, []);\n\n  /**\n   * Reset idle timer\n   */\n  const resetIdleTimer = useCallback(() => {\n    lastActivityRef.current = Date.now();\n    setIsIdle(false);\n\n    if (pauseOnIdle && idleTimeoutRef.current) {\n      clearTimeout(idleTimeoutRef.current);\n    }\n\n    if (pauseOnIdle) {\n      idleTimeoutRef.current = setTimeout(() => {\n        setIsIdle(true);\n      }, idleTimeout);\n    }\n  }, [pauseOnIdle, idleTimeout]);\n\n  /**\n   * Start countdown timer\n   */\n  const startCountdown = useCallback(() => {\n    setTimeUntilRefresh(Math.floor(currentInterval / 1000));\n    \n    countdownRef.current = setInterval(() => {\n      setTimeUntilRefresh(prev => {\n        if (prev <= 1) {\n          return Math.floor(currentInterval / 1000);\n        }\n        return prev - 1;\n      });\n    }, 1000);\n  }, [currentInterval]);\n\n  /**\n   * Start auto-refresh\n   */\n  const startAutoRefresh = useCallback(() => {\n    clearTimers();\n\n    if (!isEnabled) return;\n\n    // Check if should be paused\n    const shouldPause = \n      (pauseOnHidden && document.hidden) ||\n      (pauseOnIdle && isIdle);\n\n    if (shouldPause) {\n      setIsPaused(true);\n      return;\n    }\n\n    setIsPaused(false);\n    startCountdown();\n\n    intervalRef.current = setInterval(async () => {\n      try {\n        await callback();\n      } catch (error) {\n        console.error('Auto-refresh callback error:', error);\n      }\n    }, currentInterval);\n  }, [isEnabled, pauseOnHidden, pauseOnIdle, isIdle, currentInterval, callback, clearTimers, startCountdown]);\n\n  /**\n   * Handle visibility change\n   */\n  const handleVisibilityChange = useCallback(() => {\n    if (pauseOnHidden) {\n      if (document.hidden) {\n        setIsPaused(true);\n        clearTimers();\n      } else {\n        resetIdleTimer();\n        startAutoRefresh();\n      }\n    }\n  }, [pauseOnHidden, clearTimers, resetIdleTimer, startAutoRefresh]);\n\n  /**\n   * Handle user activity\n   */\n  const handleActivity = useCallback(() => {\n    resetIdleTimer();\n    \n    // Resume if paused due to idle\n    if (isIdle && isEnabled) {\n      startAutoRefresh();\n    }\n  }, [resetIdleTimer, isIdle, isEnabled, startAutoRefresh]);\n\n  /**\n   * Manual refresh\n   */\n  const refresh = useCallback(async () => {\n    try {\n      await callback();\n      // Reset timer after manual refresh\n      if (isEnabled && !isPaused) {\n        startAutoRefresh();\n      }\n    } catch (error) {\n      console.error('Manual refresh error:', error);\n    }\n  }, [callback, isEnabled, isPaused, startAutoRefresh]);\n\n  /**\n   * Enable auto-refresh\n   */\n  const enable = useCallback(() => {\n    setIsEnabled(true);\n  }, []);\n\n  /**\n   * Disable auto-refresh\n   */\n  const disable = useCallback(() => {\n    setIsEnabled(false);\n    clearTimers();\n  }, [clearTimers]);\n\n  /**\n   * Toggle auto-refresh\n   */\n  const toggle = useCallback(() => {\n    setIsEnabled(prev => !prev);\n  }, []);\n\n  /**\n   * Set refresh interval\n   */\n  const setRefreshInterval = useCallback((newInterval: number) => {\n    setCurrentInterval(newInterval);\n    setTimeUntilRefresh(Math.floor(newInterval / 1000));\n  }, []);\n\n  /**\n   * Setup event listeners and auto-refresh\n   */\n  useEffect(() => {\n    // Add event listeners for activity detection\n    const activityEvents = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'];\n    \n    activityEvents.forEach(event => {\n      document.addEventListener(event, handleActivity, { passive: true });\n    });\n\n    // Add visibility change listener\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n\n    // Initialize idle timer\n    resetIdleTimer();\n\n    // Cleanup\n    return () => {\n      activityEvents.forEach(event => {\n        document.removeEventListener(event, handleActivity);\n      });\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n      clearTimers();\n    };\n  }, [handleActivity, handleVisibilityChange, resetIdleTimer, clearTimers]);\n\n  /**\n   * Start/stop auto-refresh based on enabled state\n   */\n  useEffect(() => {\n    if (isEnabled) {\n      startAutoRefresh();\n    } else {\n      clearTimers();\n      setIsPaused(false);\n    }\n\n    return () => {\n      clearTimers();\n    };\n  }, [isEnabled, startAutoRefresh, clearTimers]);\n\n  /**\n   * Restart auto-refresh when idle state changes\n   */\n  useEffect(() => {\n    if (isEnabled && !isIdle && pauseOnIdle) {\n      startAutoRefresh();\n    }\n  }, [isIdle, isEnabled, pauseOnIdle, startAutoRefresh]);\n\n  return {\n    isEnabled,\n    isPaused,\n    isIdle,\n    timeUntilRefresh,\n    enable,\n    disable,\n    toggle,\n    refresh,\n    setInterval: setRefreshInterval,\n  };\n};\n\nexport default useAutoRefresh; "],"names":["useAutoRefresh","callback","options","interval","enabled","pauseOnHidden","pauseOnIdle","idleTimeout","isEnabled","setIsEnabled","useState","isPaused","setIsPaused","isIdle","setIsIdle","timeUntilRefresh","setTimeUntilRefresh","Math","floor","currentInterval","setCurrentInterval","intervalRef","useRef","countdownRef","idleTimeoutRef","lastActivityRef","Date","now","clearTimers","useCallback","current","clearInterval","clearTimeout","resetIdleTimer","setTimeout","startCountdown","setInterval","prev","startAutoRefresh","shouldPause","document","hidden","error","console","handleVisibilityChange","handleActivity","refresh","enable","disable","toggle","setRefreshInterval","newInterval","useEffect","activityEvents","forEach","event","addEventListener","passive","removeEventListener"],"mappings":"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"}