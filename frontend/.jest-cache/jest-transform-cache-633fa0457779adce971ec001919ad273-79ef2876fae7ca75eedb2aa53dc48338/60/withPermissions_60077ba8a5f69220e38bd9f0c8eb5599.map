{"version":3,"sources":["/Users/pavan/Desktop/Devops-app-dev-cursor/frontend/src/components/rbac/withPermissions.tsx"],"sourcesContent":["/**\n * Higher-Order Component for Route Protection\n * \n * Protects routes based on user permissions and roles\n */\n\nimport React from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { usePermissions } from '@/hooks/usePermissions';\n\ninterface WithPermissionsOptions {\n  permissions?: string[];\n  roles?: string[];\n  requireAll?: boolean;\n  adminOnly?: boolean;\n  resource?: string;\n  action?: string;\n  organizationId?: string;\n  redirectTo?: string;\n  fallback?: React.ComponentType;\n}\n\n/**\n * HOC to protect components/pages with permission checks\n */\nexport function withPermissions<T extends object>(\n  WrappedComponent: React.ComponentType<T>,\n  options: WithPermissionsOptions = {}\n) {\n  const {\n    permissions = [],\n    roles = [],\n    requireAll = false,\n    adminOnly = false,\n    resource,\n    action,\n    organizationId,\n    redirectTo = '/unauthorized',\n    fallback: FallbackComponent,\n  } = options;\n\n  const ProtectedComponent: React.FC<T> = (props) => {\n    const router = useRouter();\n    const { state } = useAuth();\n    const { hasPermission, hasRole, hasAnyRole, hasAnyPermission, canAccess, isAdmin } = usePermissions();\n\n    // Check if user is authenticated\n    if (!state.isAuthenticated) {\n      React.useEffect(() => {\n        router.push('/login');\n      }, [router]);\n      \n      return (\n        <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n          <div className=\"text-center\">\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Authentication Required</h2>\n            <p className=\"text-gray-600\">Redirecting to login...</p>\n          </div>\n        </div>\n      );\n    }\n\n    // Check admin requirement\n    if (adminOnly && !isAdmin()) {\n      React.useEffect(() => {\n        router.push(redirectTo);\n      }, [router]);\n\n      if (FallbackComponent) {\n        return <FallbackComponent />;\n      }\n\n      return (\n        <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n          <div className=\"text-center\">\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Access Denied</h2>\n            <p className=\"text-gray-600\">Administrator access required.</p>\n          </div>\n        </div>\n      );\n    }\n\n    // Check resource/action permission\n    if (resource && action) {\n      const hasResourceAccess = canAccess(resource, action, organizationId);\n      if (!hasResourceAccess) {\n        React.useEffect(() => {\n          router.push(redirectTo);\n        }, [router]);\n\n        if (FallbackComponent) {\n          return <FallbackComponent />;\n        }\n\n        return (\n          <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n            <div className=\"text-center\">\n              <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Access Denied</h2>\n              <p className=\"text-gray-600\">\n                You don't have permission to {action} {resource}.\n              </p>\n            </div>\n          </div>\n        );\n      }\n    }\n\n    // Check specific permissions\n    if (permissions.length > 0) {\n      const hasRequiredPermissions = requireAll\n        ? permissions.every(permission => hasPermission(permission, organizationId))\n        : hasAnyPermission(permissions);\n\n      if (!hasRequiredPermissions) {\n        React.useEffect(() => {\n          router.push(redirectTo);\n        }, [router]);\n\n        if (FallbackComponent) {\n          return <FallbackComponent />;\n        }\n\n        return (\n          <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n            <div className=\"text-center\">\n              <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Access Denied</h2>\n              <p className=\"text-gray-600\">\n                Required permissions: {permissions.join(requireAll ? ' and ' : ' or ')}\n              </p>\n            </div>\n          </div>\n        );\n      }\n    }\n\n    // Check specific roles\n    if (roles.length > 0) {\n      const hasRequiredRoles = requireAll\n        ? roles.every(role => hasRole(role))\n        : hasAnyRole(roles);\n\n      if (!hasRequiredRoles) {\n        React.useEffect(() => {\n          router.push(redirectTo);\n        }, [router]);\n\n        if (FallbackComponent) {\n          return <FallbackComponent />;\n        }\n\n        return (\n          <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n            <div className=\"text-center\">\n              <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Access Denied</h2>\n              <p className=\"text-gray-600\">\n                Required roles: {roles.join(requireAll ? ' and ' : ' or ')}\n              </p>\n            </div>\n          </div>\n        );\n      }\n    }\n\n    // All checks passed, render the component\n    return <WrappedComponent {...props} />;\n  };\n\n  ProtectedComponent.displayName = `withPermissions(${WrappedComponent.displayName || WrappedComponent.name})`;\n\n  return ProtectedComponent;\n}\n\n// Convenience HOCs for common use cases\nexport const withAuth = <T extends object>(Component: React.ComponentType<T>) =>\n  withPermissions(Component, {});\n\nexport const withAdminAccess = <T extends object>(Component: React.ComponentType<T>) =>\n  withPermissions(Component, { adminOnly: true });\n\nexport const withRoles = <T extends object>(\n  Component: React.ComponentType<T>,\n  roles: string[],\n  requireAll = false\n) =>\n  withPermissions(Component, { roles, requireAll });\n\nexport const withPermission = <T extends object>(\n  Component: React.ComponentType<T>,\n  permission: string,\n  organizationId?: string\n) =>\n  withPermissions(Component, { permissions: [permission], organizationId });\n\nexport const withResourceAccess = <T extends object>(\n  Component: React.ComponentType<T>,\n  resource: string,\n  action: string,\n  organizationId?: string\n) =>\n  withPermissions(Component, { resource, action, organizationId });\n\n// Default unauthorized page component\nexport const UnauthorizedPage: React.FC = () => (\n  <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n    <div className=\"max-w-md w-full text-center\">\n      <div className=\"bg-white shadow-lg rounded-lg p-8\">\n        <div className=\"w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full flex items-center justify-center\">\n          <svg \n            className=\"w-8 h-8 text-red-600\" \n            fill=\"none\" \n            stroke=\"currentColor\" \n            viewBox=\"0 0 24 24\"\n          >\n            <path \n              strokeLinecap=\"round\" \n              strokeLinejoin=\"round\" \n              strokeWidth={2} \n              d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\" \n            />\n          </svg>\n        </div>\n        <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">Access Denied</h1>\n        <p className=\"text-gray-600 mb-6\">\n          You don't have permission to access this page. Please contact your administrator if you believe this is an error.\n        </p>\n        <button\n          onClick={() => window.history.back()}\n          className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n        >\n          Go Back\n        </button>\n      </div>\n    </div>\n  </div>\n);\n\nexport default withPermissions;"],"names":["UnauthorizedPage","withAdminAccess","withAuth","withPermission","withPermissions","withResourceAccess","withRoles","WrappedComponent","options","permissions","roles","requireAll","adminOnly","resource","action","organizationId","redirectTo","fallback","FallbackComponent","ProtectedComponent","props","router","useRouter","state","useAuth","hasPermission","hasRole","hasAnyRole","hasAnyPermission","canAccess","isAdmin","usePermissions","isAuthenticated","React","useEffect","push","div","className","h2","p","hasResourceAccess","length","hasRequiredPermissions","every","permission","join","hasRequiredRoles","role","displayName","name","Component","svg","fill","stroke","viewBox","path","strokeLinecap","strokeLinejoin","strokeWidth","d","h1","button","onClick","window","history","back"],"mappings":"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"}