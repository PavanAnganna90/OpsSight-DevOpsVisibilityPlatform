{"version":3,"sources":["/Users/pavan/Desktop/Devops-app-dev-cursor/frontend/src/components/dashboard/InfrastructurePanel.tsx"],"sourcesContent":["import React from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { fetchInfrastructure, restartResource, deleteResource } from '../../services/infrastructureApi';\nimport { useSettings } from '../../contexts/SettingsContext';\nimport { useInfrastructurePermissions } from '../../hooks/usePermissions';\nimport { PermissionGuard } from '../rbac/PermissionGuard';\nimport { trackEvent } from '../../utils/analytics';\nimport { logAuditEvent } from '../../services/auditLogApi';\nimport EmptyState from '../ui/EmptyState';\n\nexport default function InfrastructurePanel() {\n  const { panelVisibility } = useSettings();\n  const queryClient = useQueryClient();\n  const infraPerms = useInfrastructurePermissions();\n  const { data: resources, isLoading, error, refetch } = useQuery({ \n    queryKey: ['infrastructure'], \n    queryFn: fetchInfrastructure,\n    enabled: infraPerms.canViewInfrastructure\n  });\n\n  const restartMutation = useMutation({\n    mutationFn: restartResource,\n    onSuccess: () => queryClient.invalidateQueries({ queryKey: ['infrastructure'] })\n  });\n  const deleteMutation = useMutation({\n    mutationFn: deleteResource,\n    onSuccess: () => queryClient.invalidateQueries({ queryKey: ['infrastructure'] })\n  });\n\n  if (!panelVisibility.infrastructure) return null;\n  \n  // Check permissions first\n  if (!infraPerms.canViewInfrastructure) return null;\n\n  const handleRestart = async (id: number) => {\n    trackEvent('restart_resource', { resourceId: id });\n    await logAuditEvent('restart_resource', 'admin', { resourceId: id });\n    restartMutation.mutate(id);\n  };\n  const handleDelete = async (id: number) => {\n    trackEvent('delete_resource', { resourceId: id });\n    await logAuditEvent('delete_resource', 'admin', { resourceId: id });\n    deleteMutation.mutate(id);\n  };\n\n  if (isLoading) {\n    return (\n      <section className=\"bg-white/80 dark:bg-gray-900/80 rounded-xl shadow-lg p-6 flex flex-col gap-6 min-h-[320px] items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500 mb-2\" aria-label=\"Loading infrastructure\" />\n        <span className=\"text-gray-500\">Loading infrastructure...</span>\n      </section>\n    );\n  }\n  if (error) {\n    trackEvent('error', { panel: 'Infrastructure', error: String(error) });\n    return (\n      <section className=\"bg-white/80 dark:bg-gray-900/80 rounded-xl shadow-lg p-6 flex flex-col gap-6 min-h-[320px] items-center justify-center\">\n        <EmptyState\n          illustration=\"mascot\"\n          title=\"Error Loading Infrastructure\"\n          description=\"We couldn't load infrastructure. Please try again.\"\n          action={{ label: 'Retry', onClick: refetch }}\n        />\n      </section>\n    );\n  }\n  if (!resources?.length) {\n    return (\n      <section className=\"bg-white/80 dark:bg-gray-900/80 rounded-xl shadow-lg p-6 flex flex-col gap-6 min-h-[320px] items-center justify-center\">\n        <EmptyState\n          illustration=\"mascot\"\n          title=\"No Infrastructure\"\n          description=\"No resources found.\"\n          action={{ label: 'Refresh', onClick: refetch }}\n        />\n      </section>\n    );\n  }\n  return (\n    <section className=\"bg-white/80 dark:bg-gray-900/80 rounded-xl shadow-lg p-6 flex flex-col gap-6 relative overflow-hidden min-h-[320px]\">\n      <div className=\"font-medium mb-2\">Infrastructure Resources</div>\n      <ul className=\"space-y-3\">\n        {resources.map((res: any) => (\n          <li key={res.id} className=\"flex flex-col md:flex-row md:items-center gap-2 bg-gray-50 dark:bg-gray-800 rounded-lg p-4\">\n            <div className=\"flex-1\">\n              <div className=\"font-semibold text-blue-600\">{res.name} ({res.type})</div>\n              <div className=\"text-gray-800 dark:text-gray-100\">Region: {res.region} | Status: {res.status}</div>\n              <div className=\"text-xs text-gray-400\">Cost: ${res.cost} | Last updated: {res.last_updated}</div>\n            </div>\n            <div className=\"flex gap-2 mt-2 md:mt-0\">\n              <PermissionGuard permission=\"manage_infrastructure\">\n                <button\n                  onClick={() => handleRestart(res.id)}\n                  className=\"px-3 py-1 rounded bg-yellow-600 text-white font-medium hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition\"\n                  aria-label={`Restart resource ${res.id}`}\n                >\n                  Restart\n                </button>\n              </PermissionGuard>\n              <PermissionGuard permission=\"manage_infrastructure\">\n                <button\n                  onClick={() => handleDelete(res.id)}\n                  className=\"px-3 py-1 rounded bg-red-600 text-white font-medium hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-400 transition\"\n                  aria-label={`Delete resource ${res.id}`}\n                >\n                  Delete\n                </button>\n              </PermissionGuard>\n            </div>\n          </li>\n        ))}\n      </ul>\n    </section>\n  );\n} "],"names":["InfrastructurePanel","panelVisibility","useSettings","queryClient","useQueryClient","infraPerms","useInfrastructurePermissions","data","resources","isLoading","error","refetch","useQuery","queryKey","queryFn","fetchInfrastructure","enabled","canViewInfrastructure","restartMutation","useMutation","mutationFn","restartResource","onSuccess","invalidateQueries","deleteMutation","deleteResource","infrastructure","handleRestart","id","trackEvent","resourceId","logAuditEvent","mutate","handleDelete","section","className","div","aria-label","span","panel","String","EmptyState","illustration","title","description","action","label","onClick","length","ul","map","res","li","name","type","region","status","cost","last_updated","PermissionGuard","permission","button"],"mappings":"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"}