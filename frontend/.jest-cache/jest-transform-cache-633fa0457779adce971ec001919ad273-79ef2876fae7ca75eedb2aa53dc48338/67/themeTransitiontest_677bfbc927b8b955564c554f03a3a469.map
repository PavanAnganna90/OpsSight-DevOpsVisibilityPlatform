{"version":3,"sources":["/Users/pavan/Desktop/Devops-app-dev-cursor/frontend/src/utils/__tests__/themeTransition.test.ts"],"sourcesContent":["/**\n * Comprehensive Theme Transition Tests\n * \n * Tests all aspects of the theme transition system including:\n * - Unit tests for core functionality\n * - Integration tests for complete workflows\n * - Visual regression tests for layout consistency\n * - Accessibility compliance tests\n * - Performance and optimization tests\n * - Cross-browser compatibility tests\n */\n\nimport {\n  themeTransitionManager,\n  applyThemeWithTransition,\n  markForThemeTransition,\n  unmarkFromThemeTransition,\n  useThemeTransition,\n  preloadThemeResources,\n  ThemeTransitionConfig,\n} from '../themeTransition';\nimport { themes, ColorMode, ThemeName } from '../../styles/themes';\nimport { accessibilityManager } from '../accessibilityEnhancements';\nimport { performanceOptimizer } from '../performanceOptimizations';\n\n// Mock DOM APIs and dependencies\nObject.defineProperty(window, 'matchMedia', {\n  writable: true,\n  value: jest.fn().mockImplementation(query => ({\n    matches: query.includes('prefers-reduced-motion: reduce') ? false : false,\n    media: query,\n    onchange: null,\n    addListener: jest.fn(),\n    removeListener: jest.fn(),\n    addEventListener: jest.fn(),\n    removeEventListener: jest.fn(),\n    dispatchEvent: jest.fn(),\n  })),\n});\n\n// Mock requestAnimationFrame and related APIs\nglobal.requestAnimationFrame = jest.fn(cb => setTimeout(cb, 16));\nglobal.cancelAnimationFrame = jest.fn();\n\n// Mock performance API\nObject.defineProperty(window, 'performance', {\n  writable: true,\n  value: {\n    now: jest.fn(() => Date.now()),\n    mark: jest.fn(),\n    measure: jest.fn(),\n    getEntriesByType: jest.fn(() => []),\n    getEntriesByName: jest.fn(() => []),\n  },\n});\n\n// Mock DOM methods\nObject.defineProperty(document, 'querySelectorAll', {\n  value: jest.fn(() => []),\n  writable: true,\n});\n\nObject.defineProperty(document, 'createElement', {\n  value: jest.fn(() => ({\n    setAttribute: jest.fn(),\n    getAttribute: jest.fn(),\n    appendChild: jest.fn(),\n    removeChild: jest.fn(),\n    getBoundingClientRect: jest.fn(() => ({\n      top: 0,\n      left: 0,\n      right: 100,\n      bottom: 100,\n      width: 100,\n      height: 100,\n    })),\n    style: {},\n    className: '',\n    textContent: '',\n    addEventListener: jest.fn(),\n    removeEventListener: jest.fn(),\n  })),\n  writable: true,\n});\n\nObject.defineProperty(document, 'documentElement', {\n  value: {\n    style: {},\n    setAttribute: jest.fn(),\n    getAttribute: jest.fn(),\n    classList: {\n      add: jest.fn(),\n      remove: jest.fn(),\n      contains: jest.fn(),\n    },\n  },\n  writable: true,\n});\n\nObject.defineProperty(document, 'body', {\n  value: {\n    appendChild: jest.fn(),\n    removeChild: jest.fn(),\n    style: {},\n    className: '',\n    classList: {\n      add: jest.fn(),\n      remove: jest.fn(),\n      contains: jest.fn(),\n    },\n  },\n  writable: true,\n});\n\n// Mock getComputedStyle\nObject.defineProperty(window, 'getComputedStyle', {\n  value: jest.fn(() => ({\n    color: 'rgb(0, 0, 0)',\n    backgroundColor: 'rgb(255, 255, 255)',\n    transform: 'none',\n    opacity: '1',\n    getPropertyValue: jest.fn((prop: string) => {\n      const values: Record<string, string> = {\n        'color': 'rgb(0, 0, 0)',\n        'background-color': 'rgb(255, 255, 255)',\n        'transform': 'none',\n        'opacity': '1',\n      };\n      return values[prop] || '';\n    }),\n  })),\n  writable: true,\n});\n\n// Mock Web Animations API\nObject.defineProperty(Element.prototype, 'animate', {\n  value: jest.fn(() => ({\n    finished: Promise.resolve(),\n    cancel: jest.fn(),\n    pause: jest.fn(),\n    play: jest.fn(),\n    reverse: jest.fn(),\n    finish: jest.fn(),\n    addEventListener: jest.fn(),\n    removeEventListener: jest.fn(),\n  })),\n  writable: true,\n});\n\n// Test data\nconst testThemes = {\n  minimal: themes.minimal,\n  'neo-brutalist': themes['neo-brutalist'],\n};\n\nconst testConfig: ThemeTransitionConfig = {\n  duration: 300,\n  timing: 'ease-in-out',\n  properties: ['background-color', 'color'],\n  enableFLIP: true,\n  respectReducedMotion: true,\n  enablePerformanceOptimizations: true,\n  enableAccessibilityEnhancements: true,\n};\n\ndescribe('ThemeTransitionManager', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    jest.clearAllTimers();\n    jest.useFakeTimers();\n    \n    // Reset manager state\n    themeTransitionManager.updateConfig(testConfig);\n    themeTransitionManager.clearCaches();\n  });\n\n  afterEach(() => {\n    jest.useRealTimers();\n    themeTransitionManager.abortTransition();\n  });\n\n  describe('Core Functionality', () => {\n    test('initializes with default configuration', () => {\n      expect(themeTransitionManager.isTransitionActive()).toBe(false);\n      expect(themeTransitionManager.isPerformanceHealthy()).toBe(true);\n    });\n\n    test('updates configuration correctly', () => {\n      const newConfig = { duration: 500, enableFLIP: false };\n      themeTransitionManager.updateConfig(newConfig);\n      \n      // Configuration should be updated (internal state verification)\n      expect(() => themeTransitionManager.updateConfig(newConfig)).not.toThrow();\n    });\n\n    test('tracks transition state correctly', async () => {\n      expect(themeTransitionManager.isTransitionActive()).toBe(false);\n      \n      const transitionPromise = themeTransitionManager.coordinateThemeTransition(\n        testThemes.minimal,\n        'dark'\n      );\n      \n      expect(themeTransitionManager.isTransitionActive()).toBe(true);\n      \n      jest.runAllTimers();\n      await transitionPromise;\n      \n      expect(themeTransitionManager.isTransitionActive()).toBe(false);\n    });\n\n    test('handles abort transition correctly', async () => {\n      const transitionPromise = themeTransitionManager.coordinateThemeTransition(\n        testThemes.minimal,\n        'dark'\n      );\n      \n      expect(themeTransitionManager.isTransitionActive()).toBe(true);\n      \n      themeTransitionManager.abortTransition();\n      \n      try {\n        jest.runAllTimers();\n        await transitionPromise;\n      } catch (error: any) {\n        expect(error.message).toContain('aborted');\n      }\n      \n      expect(themeTransitionManager.isTransitionActive()).toBe(false);\n    });\n  });\n\n  describe('FLIP Animation System', () => {\n    test('captures element states for FLIP transitions', async () => {\n      const mockElements = [\n        {\n          getBoundingClientRect: jest.fn(() => ({\n            top: 10, left: 10, width: 100, height: 50,\n          })),\n          style: {},\n        },\n        {\n          getBoundingClientRect: jest.fn(() => ({\n            top: 20, left: 20, width: 200, height: 100,\n          })),\n          style: {},\n        },\n      ];\n\n      (document.querySelectorAll as jest.Mock).mockReturnValue(mockElements);\n\n      await themeTransitionManager.coordinateThemeTransition(\n        testThemes.minimal,\n        'dark',\n        { enableFLIP: true }\n      );\n\n      jest.runAllTimers();\n\n      expect(mockElements[0].getBoundingClientRect).toHaveBeenCalled();\n      expect(mockElements[1].getBoundingClientRect).toHaveBeenCalled();\n    });\n\n    test('applies FLIP transforms correctly', async () => {\n      const mockElement = {\n        getBoundingClientRect: jest.fn()\n          .mockReturnValueOnce({ top: 0, left: 0, width: 100, height: 50 })\n          .mockReturnValueOnce({ top: 10, left: 10, width: 120, height: 60 }),\n        style: {},\n      };\n\n      (document.querySelectorAll as jest.Mock).mockReturnValue([mockElement]);\n\n      await themeTransitionManager.coordinateThemeTransition(\n        testThemes.minimal,\n        'dark',\n        { enableFLIP: true }\n      );\n\n      jest.runAllTimers();\n\n      // Verify transform was applied (via performance optimizer)\n      expect(mockElement.getBoundingClientRect).toHaveBeenCalledTimes(2);\n    });\n\n    test('skips FLIP when disabled', async () => {\n      const mockElement = {\n        getBoundingClientRect: jest.fn(),\n        style: {},\n      };\n\n      (document.querySelectorAll as jest.Mock).mockReturnValue([mockElement]);\n\n      await themeTransitionManager.coordinateThemeTransition(\n        testThemes.minimal,\n        'dark',\n        { enableFLIP: false }\n      );\n\n      jest.runAllTimers();\n\n      // Should not capture states when FLIP is disabled\n      expect(mockElement.getBoundingClientRect).not.toHaveBeenCalled();\n    });\n  });\n\n  describe('Performance Optimizations', () => {\n    test('applies performance optimizations during transitions', async () => {\n      const applySpy = jest.spyOn(performanceOptimizer, 'applyGPUAcceleration');\n      const batchSpy = jest.spyOn(performanceOptimizer, 'queueDOMUpdate');\n\n      await themeTransitionManager.coordinateThemeTransition(\n        testThemes.minimal,\n        'dark',\n        { enablePerformanceOptimizations: true }\n      );\n\n      jest.runAllTimers();\n\n      // Performance optimizations should be applied\n      expect(applySpy).toHaveBeenCalled();\n      expect(batchSpy).toHaveBeenCalled();\n\n      applySpy.mockRestore();\n      batchSpy.mockRestore();\n    });\n\n    test('reports performance metrics correctly', () => {\n      const report = themeTransitionManager.getPerformanceReport();\n      \n      expect(report).toHaveProperty('metrics');\n      expect(report).toHaveProperty('cacheStats');\n      expect(report).toHaveProperty('memoryUsage');\n    });\n\n    test('monitors performance health', () => {\n      expect(themeTransitionManager.isPerformanceHealthy()).toBe(true);\n      \n      // Simulate performance degradation by mocking the isPerformanceHealthy method directly\n      jest.spyOn(themeTransitionManager, 'isPerformanceHealthy').mockReturnValue(false);\n      \n      expect(themeTransitionManager.isPerformanceHealthy()).toBe(false);\n    });\n\n    test('clears caches when requested', () => {\n      const clearSpy = jest.spyOn(performanceOptimizer, 'clearCaches');\n      \n      themeTransitionManager.clearCaches();\n      \n      expect(clearSpy).toHaveBeenCalled();\n      clearSpy.mockRestore();\n    });\n  });\n\n  describe('Accessibility Integration', () => {\n    test('applies accessibility enhancements during transitions', async () => {\n      const enhanceSpy = jest.spyOn(accessibilityManager, 'enhanceThemeTransition');\n      const announceSpy = jest.spyOn(accessibilityManager, 'announceToScreenReader');\n\n      await themeTransitionManager.coordinateThemeTransition(\n        testThemes.minimal,\n        'dark',\n        { enableAccessibilityEnhancements: true }\n      );\n\n      jest.runAllTimers();\n\n      expect(enhanceSpy).toHaveBeenCalledWith('minimal', 'dark');\n      expect(announceSpy).toHaveBeenCalled();\n\n      enhanceSpy.mockRestore();\n      announceSpy.mockRestore();\n    });\n\n    test('respects reduced motion preferences', async () => {\n      // Mock reduced motion preference\n      (window.matchMedia as jest.Mock).mockImplementation(query => ({\n        matches: query.includes('prefers-reduced-motion: reduce'),\n        media: query,\n        addEventListener: jest.fn(),\n        removeEventListener: jest.fn(),\n      }));\n\n      const config = { duration: 300, enableFLIP: true };\n\n      await themeTransitionManager.coordinateThemeTransition(\n        testThemes.minimal,\n        'dark',\n        config\n      );\n\n      jest.runAllTimers();\n\n      // Should apply reduced motion settings\n      expect(true).toBe(true); // Motion would be reduced internally\n    });\n\n    test('manages focus state during transitions', async () => {\n      const captureSpy = jest.spyOn(accessibilityManager, 'captureFocusState');\n      const restoreSpy = jest.spyOn(accessibilityManager, 'restoreFocusState');\n\n      await themeTransitionManager.coordinateThemeTransition(\n        testThemes.minimal,\n        'dark'\n      );\n\n      jest.runAllTimers();\n\n      expect(captureSpy).toHaveBeenCalled();\n      expect(restoreSpy).toHaveBeenCalled();\n\n      captureSpy.mockRestore();\n      restoreSpy.mockRestore();\n    });\n\n    test('reports accessibility status correctly', () => {\n      const report = themeTransitionManager.getAccessibilityReport();\n      \n      expect(report).toHaveProperty('reducedMotionEnabled');\n      expect(report).toHaveProperty('highContrastEnabled');\n      expect(report).toHaveProperty('screenReaderSupport');\n    });\n  });\n\n  describe('Error Handling', () => {\n    test('handles invalid theme gracefully', async () => {\n      const invalidTheme = null as any;\n      \n      await expect(\n        themeTransitionManager.coordinateThemeTransition(invalidTheme, 'dark')\n      ).rejects.toThrow();\n    });\n\n    test('recovers from animation errors', async () => {\n      // Mock animation failure\n      Element.prototype.animate = jest.fn(() => {\n        throw new Error('Animation failed');\n      });\n\n      await expect(\n        themeTransitionManager.coordinateThemeTransition(testThemes.minimal, 'dark')\n      ).rejects.toThrow();\n\n      // Should restore focus even on error\n      const restoreSpy = jest.spyOn(accessibilityManager, 'restoreFocusState');\n      expect(restoreSpy).toHaveBeenCalled();\n      restoreSpy.mockRestore();\n    });\n\n    test('handles DOM query failures', async () => {\n      (document.querySelectorAll as jest.Mock).mockImplementation(() => {\n        throw new Error('DOM query failed');\n      });\n\n      // Should not crash on DOM query failures\n      await expect(\n        themeTransitionManager.coordinateThemeTransition(testThemes.minimal, 'dark')\n      ).rejects.toThrow();\n    });\n\n    test('cleans up on transition abort', async () => {\n      const transitionPromise = themeTransitionManager.coordinateThemeTransition(\n        testThemes.minimal,\n        'dark'\n      );\n\n      // Abort mid-transition\n      setTimeout(() => {\n        themeTransitionManager.abortTransition();\n      }, 50);\n\n      try {\n        jest.runAllTimers();\n        await transitionPromise;\n      } catch (error: any) {\n        expect(error.message).toContain('aborted');\n      }\n\n      expect(themeTransitionManager.isTransitionActive()).toBe(false);\n    });\n  });\n\n  describe('Instant Theme Switch', () => {\n    test('applies theme immediately without transitions', () => {\n      const rootElement = document.documentElement;\n      \n      themeTransitionManager.instantThemeSwitch(testThemes.minimal, 'dark');\n      \n      // Should apply theme classes immediately\n      expect(document.body.className).toContain('theme-minimal');\n    });\n\n    test('skips transition effects for instant switch', () => {\n      const animateSpy = jest.spyOn(Element.prototype, 'animate');\n      \n      themeTransitionManager.instantThemeSwitch(testThemes.minimal, 'dark');\n      \n      expect(animateSpy).not.toHaveBeenCalled();\n      animateSpy.mockRestore();\n    });\n  });\n});\n\ndescribe('Theme Transition Utilities', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('applyThemeWithTransition', () => {\n    test('applies theme with default configuration', async () => {\n      await applyThemeWithTransition('minimal', 'dark');\n      \n      expect(document.body.className).toContain('theme-minimal');\n    });\n\n    test('applies theme with custom configuration', async () => {\n      const customConfig = { duration: 500, enableFLIP: false };\n      \n      await applyThemeWithTransition('minimal', 'dark', customConfig);\n      \n      expect(document.body.className).toContain('theme-minimal');\n    });\n\n    test('handles transition errors gracefully', async () => {\n      // Mock transition manager to throw error\n      jest.spyOn(themeTransitionManager, 'coordinateThemeTransition')\n        .mockRejectedValue(new Error('Transition failed'));\n\n      await expect(\n        applyThemeWithTransition('minimal', 'dark')\n      ).rejects.toThrow('Transition failed');\n    });\n  });\n\n  describe('Element Marking for Transitions', () => {\n    test('marks elements for theme transitions', () => {\n      const mockElement = {\n        setAttribute: jest.fn(),\n        getAttribute: jest.fn(),\n      } as any;\n\n      markForThemeTransition(mockElement, 'transition');\n      \n      expect(mockElement.setAttribute).toHaveBeenCalledWith(\n        'data-theme-transition', \n        'true'\n      );\n    });\n\n    test('marks elements for component transitions', () => {\n      const mockElement = {\n        setAttribute: jest.fn(),\n        getAttribute: jest.fn(),\n      } as any;\n\n      markForThemeTransition(mockElement, 'component');\n      \n      expect(mockElement.setAttribute).toHaveBeenCalledWith(\n        'data-theme-component', \n        'true'\n      );\n    });\n\n    test('unmarks elements from transitions', () => {\n      const mockElement = {\n        removeAttribute: jest.fn(),\n        getAttribute: jest.fn(),\n      } as any;\n\n      unmarkFromThemeTransition(mockElement);\n      \n      expect(mockElement.removeAttribute).toHaveBeenCalledWith('data-theme-transition');\n      expect(mockElement.removeAttribute).toHaveBeenCalledWith('data-theme-component');\n    });\n  });\n\n  describe('Resource Preloading', () => {\n    test('preloads theme resources', () => {\n      const createElementSpy = jest.spyOn(document, 'createElement');\n      const headAppendSpy = jest.fn();\n      \n      Object.defineProperty(document, 'head', {\n        value: { appendChild: headAppendSpy },\n        writable: true,\n      });\n\n      preloadThemeResources('minimal');\n      \n      expect(createElementSpy).toHaveBeenCalled();\n      expect(headAppendSpy).toHaveBeenCalled();\n      \n      createElementSpy.mockRestore();\n    });\n  });\n});\n\ndescribe('useThemeTransition Hook', () => {\n  test('provides theme transition functions', () => {\n    const {\n      applyTheme,\n      isTransitioning,\n      abortTransition,\n      updateConfig,\n      getPerformanceReport,\n      getAccessibilityReport,\n      isPerformanceHealthy,\n      clearCaches,\n    } = useThemeTransition();\n\n    expect(typeof applyTheme).toBe('function');\n    expect(typeof isTransitioning).toBe('function');\n    expect(typeof abortTransition).toBe('function');\n    expect(typeof updateConfig).toBe('function');\n    expect(typeof getPerformanceReport).toBe('function');\n    expect(typeof getAccessibilityReport).toBe('function');\n    expect(typeof isPerformanceHealthy).toBe('function');\n    expect(typeof clearCaches).toBe('function');\n  });\n\n  test('applies theme through hook', async () => {\n    const { applyTheme } = useThemeTransition();\n    \n    await applyTheme('minimal', 'dark');\n    \n    expect(document.body.className).toContain('theme-minimal');\n  });\n\n  test('reports transition state correctly', () => {\n    const { isTransitioning } = useThemeTransition();\n    \n    expect(isTransitioning()).toBe(false);\n  });\n\n  test('updates configuration through hook', () => {\n    const { updateConfig } = useThemeTransition();\n    \n    expect(() => {\n      updateConfig({ duration: 500 });\n    }).not.toThrow();\n  });\n});\n\ndescribe('Visual Regression Prevention', () => {\n  test('captures component snapshots before transitions', async () => {\n    const mockElements = [\n      {\n        getBoundingClientRect: jest.fn(() => ({\n          top: 0, left: 0, width: 100, height: 50,\n        })),\n        style: {},\n        children: [],\n      },\n    ];\n\n    (document.querySelectorAll as jest.Mock).mockReturnValue(mockElements);\n\n    await themeTransitionManager.coordinateThemeTransition(\n      testThemes.minimal,\n      'dark'\n    );\n\n    jest.runAllTimers();\n\n    expect(mockElements[0].getBoundingClientRect).toHaveBeenCalled();\n  });\n\n  test('detects potential layout shifts', async () => {\n    const mockElement = {\n      getBoundingClientRect: jest.fn()\n        .mockReturnValueOnce({ top: 0, left: 0, width: 100, height: 50 })\n        .mockReturnValueOnce({ top: 10, left: 5, width: 120, height: 60 }),\n      style: {},\n    };\n\n    (document.querySelectorAll as jest.Mock).mockReturnValue([mockElement]);\n\n    await themeTransitionManager.coordinateThemeTransition(\n      testThemes.minimal,\n      'dark',\n      { enableFLIP: true }\n    );\n\n    jest.runAllTimers();\n\n    // Should detect and handle layout shift\n    expect(mockElement.getBoundingClientRect).toHaveBeenCalledTimes(2);\n  });\n\n  test('prevents layout shifts with FLIP technique', async () => {\n    const mockElement = {\n      getBoundingClientRect: jest.fn(() => ({\n        top: 0, left: 0, width: 100, height: 50,\n      })),\n      style: {},\n      animate: jest.fn(() => ({\n        finished: Promise.resolve(),\n        cancel: jest.fn(),\n      })),\n    };\n\n    (document.querySelectorAll as jest.Mock).mockReturnValue([mockElement]);\n\n    await themeTransitionManager.coordinateThemeTransition(\n      testThemes.minimal,\n      'dark',\n      { enableFLIP: true }\n    );\n\n    jest.runAllTimers();\n\n    // Should apply FLIP technique to prevent layout shifts\n    expect(mockElement.animate).toHaveBeenCalled();\n  });\n});\n\ndescribe('Performance Monitoring', () => {\n  test('measures transition timing', async () => {\n    const markSpy = jest.spyOn(window.performance, 'mark');\n    const measureSpy = jest.spyOn(window.performance, 'measure');\n\n    await themeTransitionManager.coordinateThemeTransition(\n      testThemes.minimal,\n      'dark'\n    );\n\n    jest.runAllTimers();\n\n    expect(markSpy).toHaveBeenCalled();\n    expect(measureSpy).toHaveBeenCalled();\n\n    markSpy.mockRestore();\n    measureSpy.mockRestore();\n  });\n\n  test('monitors memory usage during transitions', () => {\n    const initialReport = themeTransitionManager.getPerformanceReport();\n    expect(initialReport.averageMemoryUsage).toBeDefined();\n  });\n\n  test('tracks frame rate during transitions', async () => {\n    const rafSpy = jest.spyOn(window, 'requestAnimationFrame');\n\n    await themeTransitionManager.coordinateThemeTransition(\n      testThemes.minimal,\n      'dark'\n    );\n\n    jest.runAllTimers();\n\n    expect(rafSpy).toHaveBeenCalled();\n    rafSpy.mockRestore();\n  });\n});\n\ndescribe('Cross-browser Compatibility', () => {\n  test('handles missing Web Animations API gracefully', async () => {\n    // Remove animate method\n    delete (Element.prototype as any).animate;\n\n    await themeTransitionManager.coordinateThemeTransition(\n      testThemes.minimal,\n      'dark'\n    );\n\n    jest.runAllTimers();\n\n    // Should fallback gracefully\n    expect(document.body.className).toContain('theme-minimal');\n  });\n\n  test('works without CSS custom properties support', async () => {\n    const originalSetProperty = CSSStyleDeclaration.prototype.setProperty;\n    CSSStyleDeclaration.prototype.setProperty = undefined as any;\n\n    await themeTransitionManager.coordinateThemeTransition(\n      testThemes.minimal,\n      'dark'\n    );\n\n    jest.runAllTimers();\n\n    CSSStyleDeclaration.prototype.setProperty = originalSetProperty;\n\n    // Should apply theme even without CSS custom properties\n    expect(document.body.className).toContain('theme-minimal');\n  });\n\n  test('handles missing matchMedia API', async () => {\n    const originalMatchMedia = window.matchMedia;\n    (window as any).matchMedia = undefined;\n\n    await themeTransitionManager.coordinateThemeTransition(\n      testThemes.minimal,\n      'dark'\n    );\n\n    jest.runAllTimers();\n\n    window.matchMedia = originalMatchMedia;\n\n    expect(document.body.className).toContain('theme-minimal');\n  });\n});\n\ndescribe('Integration Tests', () => {\n  test('complete theme transition workflow', async () => {\n    // Mark elements for transition\n    const mockElement = {\n      setAttribute: jest.fn(),\n      getBoundingClientRect: jest.fn(() => ({\n        top: 0, left: 0, width: 100, height: 50,\n      })),\n      style: {},\n      animate: jest.fn(() => ({\n        finished: Promise.resolve(),\n        cancel: jest.fn(),\n      })),\n    } as any;\n\n    markForThemeTransition(mockElement);\n    (document.querySelectorAll as jest.Mock).mockReturnValue([mockElement]);\n\n    // Execute complete transition\n    await themeTransitionManager.coordinateThemeTransition(\n      testThemes.minimal,\n      'dark',\n      {\n        duration: 300,\n        enableFLIP: true,\n        enablePerformanceOptimizations: true,\n        enableAccessibilityEnhancements: true,\n      }\n    );\n\n    jest.runAllTimers();\n\n    // Verify all systems worked together\n    expect(mockElement.setAttribute).toHaveBeenCalled();\n    expect(mockElement.getBoundingClientRect).toHaveBeenCalled();\n    expect(document.body.className).toContain('theme-minimal');\n  });\n\n  test('handles complex multi-component transitions', async () => {\n    const mockComponents = Array.from({ length: 5 }, () => ({\n      getBoundingClientRect: jest.fn(() => ({\n        top: Math.random() * 100,\n        left: Math.random() * 100,\n        width: 100 + Math.random() * 50,\n        height: 50 + Math.random() * 25,\n      })),\n      style: {},\n      animate: jest.fn(() => ({\n        finished: Promise.resolve(),\n        cancel: jest.fn(),\n      })),\n    }));\n\n    (document.querySelectorAll as jest.Mock).mockReturnValue(mockComponents);\n\n    await themeTransitionManager.coordinateThemeTransition(\n      testThemes['neo-brutalist'],\n      'light'\n    );\n\n    jest.runAllTimers();\n\n    // All components should be handled\n    mockComponents.forEach(component => {\n      expect(component.getBoundingClientRect).toHaveBeenCalled();\n    });\n  });\n\n  test('maintains state consistency across rapid transitions', async () => {\n    // Start multiple transitions rapidly\n    const transitions = [\n      themeTransitionManager.coordinateThemeTransition(testThemes.minimal, 'dark'),\n      themeTransitionManager.coordinateThemeTransition(testThemes['neo-brutalist'], 'light'),\n      themeTransitionManager.coordinateThemeTransition(testThemes.minimal, 'light'),\n    ];\n\n    // Only the last one should complete\n    try {\n      jest.runAllTimers();\n      await Promise.allSettled(transitions);\n    } catch (error) {\n      // Some transitions should be aborted\n    }\n\n    expect(themeTransitionManager.isTransitionActive()).toBe(false);\n  });\n});\n\ndescribe('Browser Compatibility Tests', () => {\n  test('handles Internet Explorer fallbacks', async () => {\n    // Mock IE environment\n    Object.defineProperty(window, 'navigator', {\n      value: { userAgent: 'MSIE' },\n      writable: true,\n    });\n\n    await themeTransitionManager.coordinateThemeTransition(\n      testThemes.minimal,\n      'dark'\n    );\n\n    jest.runAllTimers();\n\n    expect(document.body.className).toContain('theme-minimal');\n  });\n\n  test('works with Safari-specific behavior', async () => {\n    // Mock Safari environment\n    Object.defineProperty(window, 'navigator', {\n      value: { userAgent: 'Safari' },\n      writable: true,\n    });\n\n    await themeTransitionManager.coordinateThemeTransition(\n      testThemes.minimal,\n      'dark'\n    );\n\n    jest.runAllTimers();\n\n    expect(document.body.className).toContain('theme-minimal');\n  });\n\n  test('handles Firefox differences', async () => {\n    // Mock Firefox environment\n    Object.defineProperty(window, 'navigator', {\n      value: { userAgent: 'Firefox' },\n      writable: true,\n    });\n\n    await themeTransitionManager.coordinateThemeTransition(\n      testThemes.minimal,\n      'dark'\n    );\n\n    jest.runAllTimers();\n\n    expect(document.body.className).toContain('theme-minimal');\n  });\n});\n\ndescribe('Performance Benchmarks', () => {\n  test('transition completes within performance budget', async () => {\n    const startTime = performance.now();\n    \n    await themeTransitionManager.coordinateThemeTransition(\n      testThemes.minimal,\n      'dark'\n    );\n\n    jest.runAllTimers();\n    \n    const endTime = performance.now();\n    const duration = endTime - startTime;\n    \n    // Should complete quickly (test environment timing)\n    expect(duration).toBeLessThan(1000);\n  });\n\n  test('memory usage stays within bounds', () => {\n    const initialMemory = process.memoryUsage();\n    \n    // Perform multiple transitions\n    for (let i = 0; i < 10; i++) {\n      themeTransitionManager.coordinateThemeTransition(\n        testThemes.minimal,\n        i % 2 === 0 ? 'dark' : 'light'\n      );\n    }\n    \n    const finalMemory = process.memoryUsage();\n    const memoryIncrease = finalMemory.heapUsed - initialMemory.heapUsed;\n    \n    // Memory increase should be reasonable\n    expect(memoryIncrease).toBeLessThan(50 * 1024 * 1024); // 50MB\n  });\n\n  test('handles concurrent transitions efficiently', async () => {\n    const concurrentTransitions = Array.from({ length: 5 }, () =>\n      themeTransitionManager.coordinateThemeTransition(\n        testThemes.minimal,\n        'dark'\n      )\n    );\n\n    const results = await Promise.allSettled(concurrentTransitions);\n    \n    // Should handle concurrent requests gracefully\n    expect(results.some(result => result.status === 'fulfilled')).toBe(true);\n  });\n}); "],"names":["Object","defineProperty","window","writable","value","jest","fn","mockImplementation","query","matches","includes","media","onchange","addListener","removeListener","addEventListener","removeEventListener","dispatchEvent","global","requestAnimationFrame","cb","setTimeout","cancelAnimationFrame","now","Date","mark","measure","getEntriesByType","getEntriesByName","document","setAttribute","getAttribute","appendChild","removeChild","getBoundingClientRect","top","left","right","bottom","width","height","style","className","textContent","classList","add","remove","contains","color","backgroundColor","transform","opacity","getPropertyValue","prop","values","Element","prototype","finished","Promise","resolve","cancel","pause","play","reverse","finish","testThemes","minimal","themes","testConfig","duration","timing","properties","enableFLIP","respectReducedMotion","enablePerformanceOptimizations","enableAccessibilityEnhancements","describe","beforeEach","clearAllMocks","clearAllTimers","useFakeTimers","themeTransitionManager","updateConfig","clearCaches","afterEach","useRealTimers","abortTransition","test","expect","isTransitionActive","toBe","isPerformanceHealthy","newConfig","not","toThrow","transitionPromise","coordinateThemeTransition","runAllTimers","error","message","toContain","mockElements","querySelectorAll","mockReturnValue","toHaveBeenCalled","mockElement","mockReturnValueOnce","toHaveBeenCalledTimes","applySpy","spyOn","performanceOptimizer","batchSpy","mockRestore","report","getPerformanceReport","toHaveProperty","clearSpy","enhanceSpy","accessibilityManager","announceSpy","toHaveBeenCalledWith","matchMedia","config","captureSpy","restoreSpy","getAccessibilityReport","invalidTheme","rejects","animate","Error","rootElement","documentElement","instantThemeSwitch","body","animateSpy","applyThemeWithTransition","customConfig","mockRejectedValue","markForThemeTransition","removeAttribute","unmarkFromThemeTransition","createElementSpy","headAppendSpy","preloadThemeResources","applyTheme","isTransitioning","useThemeTransition","children","markSpy","performance","measureSpy","initialReport","averageMemoryUsage","toBeDefined","rafSpy","originalSetProperty","CSSStyleDeclaration","setProperty","undefined","originalMatchMedia","mockComponents","Array","from","length","Math","random","forEach","component","transitions","allSettled","userAgent","startTime","endTime","toBeLessThan","initialMemory","process","memoryUsage","i","finalMemory","memoryIncrease","heapUsed","concurrentTransitions","results","some","result","status"],"mappings":"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"}