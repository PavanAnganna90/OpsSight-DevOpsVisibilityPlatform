# OpsSight Docker Compose Development Override
# Use: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

version: '3.8'

services:
  opssight-frontend:
    build:
      target: development
      args:
        - NODE_ENV=development
        - NEXT_PUBLIC_APP_NAME=OpsSight
        - NEXT_PUBLIC_APP_VERSION=1.0.0-dev
        - NEXT_PUBLIC_APP_ENV=development
    environment:
      - NODE_ENV=development
      - NEXT_PUBLIC_APP_ENV=development
      - FAST_REFRESH=true
      - TURBO_MODE=true
    env_file:
      - .env.local
    volumes:
      - .:/app
      - /app/node_modules
      - /app/.next
    ports:
      - "3000:3000"
      - "9229:9229" # Debug port
    command: npm run dev
    labels: []

  postgres:
    environment:
      - POSTGRES_DB=opssight_dev
      - POSTGRES_USER=dev_user
      - POSTGRES_PASSWORD=dev_password
    ports:
      - "5433:5432"

  redis:
    command: redis-server --appendonly yes
    ports:
      - "6380:6379"

  # Disable production services in development
  nginx:
    profiles: ["production"]
  
  prometheus:
    profiles: ["monitoring"]
  
  grafana:
    profiles: ["monitoring"]
  
  loki:
    profiles: ["monitoring"]
  
  promtail:
    profiles: ["monitoring"] 