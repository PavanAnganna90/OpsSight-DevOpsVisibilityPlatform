apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: opssight-production
  namespace: opssight

namespace: opssight

resources:
- ../base

patchesStrategicMerge:
- patches/replicas.yaml
- patches/resources.yaml
- patches/config.yaml
- patches/security.yaml

configMapGenerator:
- name: opssight-env-config
  behavior: merge
  literals:
  - ENVIRONMENT=production
  - DEBUG=false
  - LOG_LEVEL=INFO

secretGenerator:
- name: opssight-production-secrets
  files:
  - DATABASE_URL=secrets/database-url
  - REDIS_URL=secrets/redis-url
  - JWT_SECRET=secrets/jwt-secret

images:
- name: opssight/backend
  newTag: v1.0.0
- name: opssight/frontend
  newTag: v1.0.0

namePrefix: prod-

commonLabels:
  environment: production
  app.kubernetes.io/instance: production

patches:
- target:
    kind: Ingress
    name: opssight-ingress
  patch: |-
    - op: replace
      path: /spec/rules/0/host
      value: opssight.dev
    - op: replace
      path: /metadata/annotations/alb.ingress.kubernetes.io~1certificate-arn
      value: arn:aws:acm:us-west-2:ACCOUNT_ID:certificate/PROD_CERT_ID