apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Base configuration
resources:
- ../../base
- namespace.yaml
- external-secrets.yaml
- network-policies.yaml
- monitoring.yaml

# Production-specific patches
patchesStrategicMerge:
- backend-deployment-patch.yaml
- frontend-deployment-patch.yaml
- ingress-patch.yaml

# Image overrides
images:
- name: ghcr.io/opssight/backend
  newTag: latest
- name: ghcr.io/opssight/frontend
  newTag: latest

# Namespace
namespace: opssight-production

# Name prefix for all resources
namePrefix: prod-

# Labels applied to all resources
commonLabels:
  environment: production
  version: v1.0.0
  managed-by: kustomize

# Annotations applied to all resources
commonAnnotations:
  deployment.kubernetes.io/revision: "1"
  config.kubernetes.io/origin: "kustomize"

# Resource configuration
replicas:
- name: opssight-backend
  count: 5
- name: opssight-frontend
  count: 3

# ConfigMap generators
configMapGenerator:
- name: opssight-config
  literals:
  - ENVIRONMENT=production
  - LOG_LEVEL=INFO
  - METRICS_ENABLED=true
  - CACHE_TTL=3600
  - MAX_CONNECTIONS=100
  files:
  - config/app-config.yaml
  - config/logging.conf

# Secrets are managed by External Secrets Operator
# See external-secrets.yaml for configuration

# Transformations
transformers:
- resource-limits.yaml
- security-context.yaml

# Generators
generators:
- monitoring-rules.yaml