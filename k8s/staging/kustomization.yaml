apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: opssight-staging
  namespace: opssight

namespace: opssight

resources:
- ../base

patchesStrategicMerge:
- patches/replicas.yaml
- patches/resources.yaml
- patches/config.yaml

configMapGenerator:
- name: opssight-env-config
  behavior: merge
  literals:
  - ENVIRONMENT=staging
  - DEBUG=true
  - LOG_LEVEL=DEBUG

secretGenerator:
- name: opssight-staging-secrets
  literals:
  - DATABASE_URL=postgresql://staging_user:staging_pass@staging-db:5432/opssight_staging
  - REDIS_URL=redis://staging-redis:6379/0

images:
- name: opssight/backend
  newTag: staging-latest
- name: opssight/frontend
  newTag: staging-latest

namePrefix: staging-

commonLabels:
  environment: staging
  app.kubernetes.io/instance: staging

patches:
- target:
    kind: Ingress
    name: opssight-ingress
  patch: |-
    - op: replace
      path: /spec/rules/0/host
      value: staging.opssight.dev